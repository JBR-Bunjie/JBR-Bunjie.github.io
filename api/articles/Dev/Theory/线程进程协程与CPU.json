{"title":"线程、进程、协程、与 CPU 多核","uid":"3be3467b821b2606f2e2f4a1380f6410","slug":"Dev/Theory/线程进程协程与CPU","date":"2021-05-23T04:23:23.000Z","updated":"2023-10-27T19:44:22.000Z","comments":true,"path":"api/articles/Dev/Theory/线程进程协程与CPU.json","keywords":null,"cover":"https://raw.githubusercontent.com/JBR-Bunjie/JBR-Bunjie/main/back.jpg","content":"<h1 id=\"线程进程协程与-cpu-多核\">线程、进程、协程、与 CPU 多核</h1>\r\n<h2 id=\"一进程线程协程的概念\">一、进程、线程、协程的概念</h2>\r\n<p><strong>进程</strong>：</p>\r\n<p>是并发执行的程序在执行过程中分配和管理资源的基本单位，是一个动态概念，竞争计算机系统资源的基本单位。</p>\r\n<p><strong>线程</strong>：</p>\r\n<p>是进程的一个执行单元，是进程内科调度实体。比进程更小的独立运行的基本单位。线程也被称为轻量级进程。</p>\r\n<p><strong>协程</strong>：</p>\r\n<p>是一种比线程更加轻量级的存在。一个线程也可以拥有多个协程。其执行过程更类似于子例程，或者说不带返回值的函数调用。</p>\r\n<h2 id=\"二进程和线程的区别\">二、进程和线程的区别</h2>\r\n<p><strong>地址空间</strong>：</p>\r\n<p>线程共享本进程的地址空间，而进程之间是独立的地址空间。</p>\r\n<p><strong>资源</strong>：</p>\r\n<p>线程共享本进程的资源如内存、I/O、cpu\r\n等，不利于资源的管理和保护，而进程之间的资源是独立的，能很好的进行资源管理和保护。</p>\r\n<p><strong>健壮性</strong>：</p>\r\n<p>多进程要比多线程健壮，一个进程崩溃后，在保护模式下不会对其他进程产生影响，但是一个线程崩溃整个进程都死掉。</p>\r\n<p><strong>执行过程</strong>：</p>\r\n<p>每个独立的进程有一个程序运行的入口、顺序执行序列和程序入口，执行开销大。</p>\r\n<p>但是线程不能独立执行，必须依存在应用程序中，由应用程序提供多个线程执行控制，执行开销小。</p>\r\n<p><strong>可并发性</strong>：</p>\r\n<p>两者均可并发执行。</p>\r\n<p><strong>切换时</strong>：</p>\r\n<p>进程切换时，消耗的资源大，效率高。所以涉及到频繁的切换时，使用线程要好于进程。同样如果要求同时进行并且又要共享某些变量的并发操作，只能用线程不能用进程。</p>\r\n<p><strong>其他</strong>：</p>\r\n<p>线程是处理器调度的基本单位，但是进程不是。</p>\r\n<h2 id=\"三协程和线程的区别\">三、协程和线程的区别</h2>\r\n<p>协程避免了无意义的调度，由此可以提高性能，但程序员必须自己承担调度的责任。同时，协程也失去了标准线程使用多\r\nCPU 的能力。</p>\r\n<p><strong>线程</strong></p>\r\n<p>相对独立</p>\r\n<p>有自己的上下文</p>\r\n<p>切换受系统控制；</p>\r\n<p><strong>协程</strong></p>\r\n<p>相对独立</p>\r\n<p>有自己的上下文</p>\r\n<p>切换由自己控制，由当前协程切换到其他协程由当前协程来控制。</p>\r\n<h2\r\nid=\"四何时使用多进程何时使用多线程\">四、何时使用多进程，何时使用多线程？</h2>\r\n<p>对资源的管理和保护要求高，不限制开销和效率时，使用多进程。</p>\r\n<p>要求效率高，频繁切换时，资源的保护管理要求不是很高时，使用多线程。</p>\r\n<h2 id=\"五为什么会有线程\">五、为什么会有线程？</h2>\r\n<p>每个进程都有自己的地址空间，即进程空间，在网络或多用户换机下，一个服务器通常需要接收大量不确定数量用户的并发请求，为每一个请求都创建一个进程显然行不通（系统开销大响应用户请求效率低），因此操作系统中线程概念被引进。</p>\r\n<h2 id=\"六python-多线程的问题面试问题\">六、*python\r\n多线程的问题（面试问题）</h2>\r\n<p><strong>存在问题</strong>：</p>\r\n<p>python\r\n由于历史遗留的问题，严格说多个线程并不会同时执行（没法有效利用多核处理器，python\r\n的并发只是在交替执行不同的代码）。</p>\r\n<p>多线程在 Python 中只能交替执行，即使 100 个线程跑在 100 核 CPU\r\n上，也只能用到 1 个核。所以 python\r\n的多线程并发并不能充分利用多核，并发没有 java 的并发严格。</p>\r\n<p><strong>原因</strong>：</p>\r\n<p>原因就在于 GIL ，在 Cpython 解释器（Python\r\n语言的主流解释器）中，有一把全局解释锁（GIL, Global Interpreter\r\nLock），在解释器解释执行 Python 代码时，任何 Python\r\n线程执行前，都先要得到这把 GIL 锁。</p>\r\n<p>这个 GIL 全局锁实际上把所有线程的执行代码都给上了锁。</p>\r\n<p>这意味着，python 在任何时候，只可能有一个线程在执行代码。</p>\r\n<p>其它线程要想获得 CPU\r\n执行代码指令，就必须先获得这把锁，如果锁被其它线程占用了，那么该线程就只能等待，直到占有该锁的线程释放锁才有执行代码指令的可能。</p>\r\n<p><strong>多个线程一起执行反而更加慢的原因</strong>：</p>\r\n<p>同一时刻，只有一个线程在运行，其它线程只能等待，即使是多核\r\nCPU，也没办法让多个线程「并行」地同时执行代码，只能是交替执行，因为多线程涉及到上线文切换、锁机制处理（获取锁，释放锁等），所以，多线程执行不快反慢。</p>\r\n<p><strong>什么时候 GIL 被释放？</strong></p>\r\n<p>当一个线程遇到 I/O 任务时，将释放 GIL。</p>\r\n<p>计算密集型（CPU-bound）线程执行 100\r\n次解释器的计步（ticks）时（计步可粗略看作 Python\r\n虚拟机的指令），也会释放 GIL。</p>\r\n<p>即，每执行 100 条字节码，解释器就自动释放 GIL\r\n锁，让别的线程有机会执行。</p>\r\n<p>不过，Python\r\n虽然不能利用多线程实现多核任务，但可以通过多进程实现多核任务。多个\r\nPython 进程有各自独立的 GIL 锁，互不影响。</p>\r\n<p><em>本条参考博客</em>：</p>\r\n<p>http://www.sohu.com/a/230407177_99992472</p>\r\n<h2 id=\"七进程通信方式选读\">七、*进程通信方式（选读）</h2>\r\n<p><strong>管道</strong>：</p>\r\n<p>速度慢，容量有限，只有父子进程能通讯</p>\r\n<p><strong>FIFO</strong>：</p>\r\n<p>任何进程间都能通讯，但速度慢</p>\r\n<p><strong>消息队列</strong>：</p>\r\n<p>容量受到系统限制，且要注意第一次读的时候，要考虑上一次没有读完数据的问题</p>\r\n<p><strong>信号量</strong>：</p>\r\n<p>不能传递复杂消息，只能用来同步</p>\r\n<p><strong>共享内存区</strong>：</p>\r\n<p>能够很容易控制容量，速度快，但要保持同步，比如一个进程在写的时候，另一个进程要注意读写的问题，相当于线程中的线程安全，当然，共享内存区同样可以用作线程间通讯，不过没这个必要，线程间本来就已经共享了同一进程内的一块内存</p>\r\n<p><em>本条参考博客</em>：</p>\r\n<p>https://blog.csdn.net/weixin_40283480/article/details/82155704</p>\r\n<h2 id=\"cpu-线程-和-java-线程\">CPU 线程 和 Java 线程</h2>\r\n<p><a href=\"https://www.cnblogs.com/webglcn/p/10639065.html\">CPU 线程 和\r\nJava 线程 - webglcn - 博客园 (cnblogs.com)</a></p>\r\n<p><a\r\nhref=\"https://blog.csdn.net/nandao158/article/details/105896980\">进程、线程和\r\nCPU 之间的关系（一）<em>nandao158 的博客-CSDN 博客</em>线程和\r\ncpu</a></p>\r\n<p>进程是程序运行资源分配的最小单位\r\n。进程是操作系统进行资源分配的最小单位,其中资源包括:CPU、内存空间、 磁盘\r\nIO 等,同一进程中的多条线程共享该进程中的全部系统资源,而进程和进程\r\n之间是相互独立的。进程是具有一定独立功能的程序关于某个数据集合上的一次\r\n运行活动,进程是系统进行资源分配和调度的一个独立单位。\r\n进程是程序在计算机上的一次执行活动。当你运行一个程序,你就启动了一\r\n个进程。显然,程序是死的、静态的,进程是活的、动态的。进程可以分为系统进\r\n程和用户进程。凡是用于完成操作系统的各种功能的进程就是系统进程,它们就\r\n是处于运行状态下的操作系统本身,用户进程就是所有由你启动的进程。</p>\r\n<p>线程是 CPU 调度的最小单位,必须依赖于进程而存在\r\n线程是进程的一个实体,是 CPU 调度和分派的基本单位,它是比进程更小的、\r\n能独立运行的基本单位。线程自己基本上不拥有系统资源,只拥有一点在运行中\r\n必不可少的资源(如程序计数器,一组寄存器和栈),但是它可与同属一个进程的其\r\n他的线程共享进程所拥有的全部资源。 线程无处不在\r\n任何一个程序都必须要创建线程,特别是 Java 不管任何程序都必须启动一个 main\r\n函数的主线程; Java Web 开发里面的定时任务、定时器、JSP 和 Servlet、异\r\n步消息处理机制,远程访问接口RM等,任何一个监听事件, onclick的触发事件等都\r\n离不开线程和并发的知识。</p>\r\n<ol start=\"2\" type=\"1\">\r\n<li>Java 多线程并不是由于 cpu 线程数为多个才称为多线程，当 Java\r\n线程数大于 cpu\r\n线程数，操作系统使用时间片机制，采用线程调度算法，频繁的进行线程切换。</li>\r\n</ol>\r\n<p><a href=\"https://www.zhihu.com/question/27406575\">(10 封私信 / 81\r\n条消息) CPU 的线程与操作系统的线程有何关系？ - 知乎 (zhihu.com)</a></p>\r\n","text":"线程、进程、协程、与 CPU 多核 一、进程、线程、协程的概念 进程： 是并发执行的程序在执行过程中分配和管理资源的基本单位，是一个动态概念，竞争计算机系统资源的基本单位。 线程： 是进程的一个执行单元，是进程内科调度实体。比进程更小的独立运行的基本单位。线程也被称为轻量级进程。...","link":"","photos":[],"count_time":{"symbolsCount":"3.1k","symbolsTime":"3 mins."},"categories":[{"name":"Theroy","slug":"Theroy","count":5,"path":"api/categories/Theroy.json"}],"tags":[{"name":"Theroy","slug":"Theroy","count":5,"path":"api/tags/Theroy.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E7%BA%BF%E7%A8%8B%E8%BF%9B%E7%A8%8B%E5%8D%8F%E7%A8%8B%E4%B8%8E-cpu-%E5%A4%9A%E6%A0%B8\"><span class=\"toc-text\">线程、进程、协程、与 CPU 多核</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%80%E8%BF%9B%E7%A8%8B%E7%BA%BF%E7%A8%8B%E5%8D%8F%E7%A8%8B%E7%9A%84%E6%A6%82%E5%BF%B5\"><span class=\"toc-text\">一、进程、线程、协程的概念</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BA%8C%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%8C%BA%E5%88%AB\"><span class=\"toc-text\">二、进程和线程的区别</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%89%E5%8D%8F%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%8C%BA%E5%88%AB\"><span class=\"toc-text\">三、协程和线程的区别</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%9B%9B%E4%BD%95%E6%97%B6%E4%BD%BF%E7%94%A8%E5%A4%9A%E8%BF%9B%E7%A8%8B%E4%BD%95%E6%97%B6%E4%BD%BF%E7%94%A8%E5%A4%9A%E7%BA%BF%E7%A8%8B\"><span class=\"toc-text\">四、何时使用多进程，何时使用多线程？</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BA%94%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E6%9C%89%E7%BA%BF%E7%A8%8B\"><span class=\"toc-text\">五、为什么会有线程？</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%85%ADpython-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9A%84%E9%97%AE%E9%A2%98%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98\"><span class=\"toc-text\">六、*python\r\n多线程的问题（面试问题）</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%83%E8%BF%9B%E7%A8%8B%E9%80%9A%E4%BF%A1%E6%96%B9%E5%BC%8F%E9%80%89%E8%AF%BB\"><span class=\"toc-text\">七、*进程通信方式（选读）</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#cpu-%E7%BA%BF%E7%A8%8B-%E5%92%8C-java-%E7%BA%BF%E7%A8%8B\"><span class=\"toc-text\">CPU 线程 和 Java 线程</span></a></li></ol></li></ol>","author":{"name":"JBR_Bunjie","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/90251718?v=4","link":"/","description":"仿生程序员会在光环上遇见AI乐正绫吗？","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili-fill.svg","link":"https://space.bilibili.com/415377461"},"github":{"icon":"/svg/social_github.svg","link":"https://github.com/JBR-Bunjie"}}}},"mapped":true,"prev_post":{"title":"formdata使用攻略","uid":"a7427683ffea4c224c83d4bf0c430464","slug":"Language Learning/JavaScript/formdata使用攻略","date":"2021-06-02T04:23:23.000Z","updated":"2023-10-27T19:49:28.000Z","comments":true,"path":"api/articles/Language Learning/JavaScript/formdata使用攻略.json","keywords":null,"cover":"https://raw.githubusercontent.com/JBR-Bunjie/JBR-Bunjie/main/back.jpg","text":"formdata使用攻略 FormData 对象的使用 - Web API 接口参考 | MDN (mozilla.org) FormData 对象用以将数据编译成键值对，以便用XMLHttpRequest来发送数据。其主要用于发送表单数据，但亦可用于发送带键数据(keyed d...","link":"","photos":[],"count_time":{"symbolsCount":"3.4k","symbolsTime":"3 mins."},"categories":[{"name":"Language Learning","slug":"Language-Learning","count":6,"path":"api/categories/Language-Learning.json"},{"name":"Javascripts","slug":"Language-Learning/Javascripts","count":1,"path":"api/categories/Language-Learning/Javascripts.json"}],"tags":[{"name":"Language Learning","slug":"Language-Learning","count":16,"path":"api/tags/Language-Learning.json"},{"name":"Javascripts","slug":"Javascripts","count":3,"path":"api/tags/Javascripts.json"}],"author":{"name":"JBR_Bunjie","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/90251718?v=4","link":"/","description":"仿生程序员会在光环上遇见AI乐正绫吗？","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili-fill.svg","link":"https://space.bilibili.com/415377461"},"github":{"icon":"/svg/social_github.svg","link":"https://github.com/JBR-Bunjie"}}}}},"next_post":{"title":"计算机编码梳理","uid":"5b286fb1e51c3a9c0edf1921a9c938c7","slug":"Language Learning/Endcoding","date":"2021-05-20T18:23:23.000Z","updated":"2023-10-27T20:05:21.000Z","comments":true,"path":"api/articles/Language Learning/Endcoding.json","keywords":null,"cover":"https://raw.githubusercontent.com/JBR-Bunjie/JBR-Bunjie/main/back.jpg","text":"计算机编码梳理 ASCII码 描述 这是计算机编码发展历程里的第一阶段：ASCII码，即：American Standard Code for Information Interchange，美国信息交换标准代码 设计思路： 在计算机内部存储单元的最小单位时Byte。不过Byte...","link":"","photos":[],"count_time":{"symbolsCount":"5.2k","symbolsTime":"5 mins."},"categories":[{"name":"Encoding","slug":"Encoding","count":1,"path":"api/categories/Encoding.json"}],"tags":[{"name":"Encoding","slug":"Encoding","count":1,"path":"api/tags/Encoding.json"}],"author":{"name":"JBR_Bunjie","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/90251718?v=4","link":"/","description":"仿生程序员会在光环上遇见AI乐正绫吗？","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili-fill.svg","link":"https://space.bilibili.com/415377461"},"github":{"icon":"/svg/social_github.svg","link":"https://github.com/JBR-Bunjie"}}}}}}