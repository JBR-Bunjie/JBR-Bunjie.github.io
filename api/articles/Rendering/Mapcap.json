{"title":"Mapcap","uid":"e381c275e6062a6db30ed6f89e560299","slug":"Rendering/Mapcap","date":"2023-04-29T04:23:23.000Z","updated":"2023-10-27T20:19:51.000Z","comments":true,"path":"api/articles/Rendering/Mapcap.json","keywords":null,"cover":"https://raw.githubusercontent.com/JBR-Bunjie/JBR-Bunjie/main/back.jpg","content":"<h2 id=\"What-is-Mapcap\"><a href=\"#What-is-Mapcap\" class=\"headerlink\" title=\"What is Mapcap?\"></a>What is Mapcap?</h2><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>MatCap is a method of light expression using pre-rendered images. This technique uses a picture of a sphere that represents the material and light to simulate lighting.</p>\n<p><a href=\"https://docs.unity3d.com/Packages/com.unity.toonshader@0.9/manual/MatCap.html\">Material Capture(MatCap) Settings | Unity Toon Shader | 0.9.4-preview (unity3d.com)</a></p></blockquote>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p><em>Material capture (“MatCap”) shaders</em> are popular effects used in most 3D modeling tools: A material is captured by rendering a sphere into a texture. Models can be shaded by making a simple lookup into the reference texture.<br>This type of shading is very efficient – no complicated computations, only a single texture lookup per pixel. The effect works great for previewing objects in a 3D modeling tool. <strong>However, it is less suited for games: The reference texture only stores one side of a sphere. The effect breaks down, when the camera moves around the object.</strong></p>\n<p><a href=\"https://digitalrune.github.io/DigitalRune-Documentation/html/9a8c8b37-b996-477a-aeab-5d92714be3ca.htm\">Material Capture (MatCap) Shaders (digitalrune.github.io)</a></p></blockquote>\n<p><a href=\"https://zhuanlan.zhihu.com/p/25314364\">【Unity Shader 实践】基于 MatCap 实现适于移动平台的“次时代”车漆 Shader - 知乎 (zhihu.com)</a></p></blockquote>\n<h2 id=\"应用\"><a href=\"#应用\" class=\"headerlink\" title=\"应用\"></a>应用</h2><h3 id=\"真实感渲染\"><a href=\"#真实感渲染\" class=\"headerlink\" title=\"真实感渲染\"></a>真实感渲染</h3><p>简单来说，我们会用 matcap 贴图来存储很多预制好的光照、色彩等具体效果，这样我们用一张贴图就可以快速得到我们所希望的材质效果。</p>\n<p>对于正常的真实感渲染上，matcap 的用法具有较大的局限性——因为真实感渲染下我们往往要求计算过程遵守物理规则，因此一般仅用 matcap 来节约性能开销：我们可以为场景中的不重要的景物、物件等使用 matcap，这样能保证它们具有足够质感的同时，尽可能的节约硬件资源。</p>\n<p>这一点好像又和 LOD 等东西也可以结合起来看待，有一种处理方法就是，当离人物距离太远时，比如远方的树木，不再执行完整的渲染，而一种永远正对角色的面片，而这种改用这种 matcap 来实现，或者改用别的节省资源的办法等。</p>\n<p>其一般用法可以参看：<a href=\"https://www.bilibili.com/video/BV1GR4y1b76n/?spm_id_from=333.337.search-card.all.click&vd_source=c8eda79dd90c30ff02e09fb39906ac54\">(美学阿姨)MatCap 材质原理讲解与 UE5 中的实现方法_哔哩哔哩_bilibili</a></p>\n<p>但是，当到了 NPR 领域，就完全不是这么一回事了。</p>\n<h3 id=\"NPR-下的-Matcap\"><a href=\"#NPR-下的-Matcap\" class=\"headerlink\" title=\"NPR 下的 Matcap\"></a>NPR 下的 Matcap</h3><p>先从 mmd 中说起：</p>\n<p>mmd 中一般会有三类贴图，包括：SPA\\SPH、TEX、TOON。后两者很好理解，关键是 SPA\\SPH 贴图。</p>\n<p>就简单来说，我们可以参考这个：</p>\n<ul>\n<li><a href=\"https://www.nagongze.me/mmd-sphere-texture/\">Spa 及 Sph 的高光貼圖介紹 (nagongze.me)</a></li>\n<li>[<a href=\"https://www.deviantart.com/mmdloid/art/MMD-Why-model-should-use-Matcap-908386574\">MMD] Why model should use Matcap. by MMDLOID on DeviantArt</a></li>\n</ul>\n<p>发现了吗，其实 SPA\\SPH 所产生的效果很相似，都是将提前存储好的内容映射到模型上。就细分而言，SPA\\SPH 是基于球体映射的贴图技术，它将 2D 图像映射到 3D 模型的球体表面，用于模拟光照效果。我们用它来为模型表面创建天使环等效果。而 Matcap 贴图则用于模拟模型表面的材质和光照效果。这么看来 SPA\\SPH 好像可以直接归到 Matcap 的一个子类里。</p>\n<p>也就是说，我们可以在 NPR 中使用 matcap 来实现很多特殊的内容，比如 Angle Ring 等</p>\n<h2 id=\"实际使用：Matcap-采样-uv-的构造\"><a href=\"#实际使用：Matcap-采样-uv-的构造\" class=\"headerlink\" title=\"实际使用：Matcap 采样 uv 的构造\"></a>实际使用：Matcap 采样 uv 的构造</h2><h3 id=\"经典-Matcap-采样\"><a href=\"#经典-Matcap-采样\" class=\"headerlink\" title=\"经典 Matcap 采样\"></a>经典 Matcap 采样</h3><h3 id=\"改进-1：\"><a href=\"#改进-1：\" class=\"headerlink\" title=\"改进 1：\"></a>改进 1：</h3><p><a href=\"https://zhuanlan.zhihu.com/p/79040521\">MatCap Shader 改进：解决平面渲染和环境反射问题 - 知乎 (zhihu.com)</a></p>\n<h2 id=\"补充：法线变换\"><a href=\"#补充：法线变换\" class=\"headerlink\" title=\"补充：法线变换\"></a>补充：法线变换</h2><p>补一个将模型法线转换到视角空间</p>\n<ul>\n<li>数学推导：</li>\n<li>结论：<a href=\"https://community.khronos.org/t/transformation-of-normals-into-eye-space/63611\">Transformation of normals into eye space. - OpenGL &#x2F; OpenGL: Advanced Coding - Khronos Forums</a></li>\n</ul>\n<h2 id=\"实际使用案例\"><a href=\"#实际使用案例\" class=\"headerlink\" title=\"实际使用案例\"></a>实际使用案例</h2><ul>\n<li><a href=\"https://www.bilibili.com/video/BV12Y4y157sp/?vd_source=c8eda79dd90c30ff02e09fb39906ac54\">blender 中使用 mmd 中 spa 贴图的节点分享_哔哩哔哩_bilibili</a></li>\n</ul>\n","text":"What is Mapcap? MatCap is a method of light expression using pre-rendered images. This technique uses a picture of a sphere that represents ...","link":"","photos":[],"count_time":{"symbolsCount":"2.1k","symbolsTime":"2 mins."},"categories":[{"name":"Unity","slug":"Unity","count":17,"path":"api/categories/Unity.json"},{"name":"Shader","slug":"Unity/Shader","count":7,"path":"api/categories/Unity/Shader.json"}],"tags":[{"name":"Unity","slug":"Unity","count":17,"path":"api/tags/Unity.json"},{"name":"Shader","slug":"Shader","count":33,"path":"api/tags/Shader.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#What-is-Mapcap\"><span class=\"toc-text\">What is Mapcap?</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%BA%94%E7%94%A8\"><span class=\"toc-text\">应用</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%9C%9F%E5%AE%9E%E6%84%9F%E6%B8%B2%E6%9F%93\"><span class=\"toc-text\">真实感渲染</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#NPR-%E4%B8%8B%E7%9A%84-Matcap\"><span class=\"toc-text\">NPR 下的 Matcap</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%AE%9E%E9%99%85%E4%BD%BF%E7%94%A8%EF%BC%9AMatcap-%E9%87%87%E6%A0%B7-uv-%E7%9A%84%E6%9E%84%E9%80%A0\"><span class=\"toc-text\">实际使用：Matcap 采样 uv 的构造</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%BB%8F%E5%85%B8-Matcap-%E9%87%87%E6%A0%B7\"><span class=\"toc-text\">经典 Matcap 采样</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%94%B9%E8%BF%9B-1%EF%BC%9A\"><span class=\"toc-text\">改进 1：</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%A1%A5%E5%85%85%EF%BC%9A%E6%B3%95%E7%BA%BF%E5%8F%98%E6%8D%A2\"><span class=\"toc-text\">补充：法线变换</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%AE%9E%E9%99%85%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B\"><span class=\"toc-text\">实际使用案例</span></a></li></ol>","author":{"name":"JBR_Bunjie","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/90251718?v=4","link":"/","description":"仿生程序员会在光环上遇见AI乐正绫吗？","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili-fill.svg","link":"https://space.bilibili.com/415377461"},"github":{"icon":"/svg/social_github.svg","link":"https://github.com/JBR-Bunjie"}}}},"mapped":true,"prev_post":{"title":"PBR","uid":"db4c4d4811d5722c3a2acb135b7ca20d","slug":"Rendering/PBR","date":"2023-05-01T04:23:23.000Z","updated":"2023-11-01T04:34:31.875Z","comments":true,"path":"api/articles/Rendering/PBR.json","keywords":null,"cover":"https://raw.githubusercontent.com/JBR-Bunjie/JBR-Bunjie/main/back.jpg","text":"PBR PBR，或者用更通俗一些的称呼是指基于物理的渲染(Physically Based Rendering)，它指的是一些在不同程度上都基于与现实世界的物理原理更相符的基本理论所构成的渲染技术的集合。 PBR 综述PBR 是基于物理的渲染，具体表现为使用一种更符合物理学规律的...","link":"","photos":[],"count_time":{"symbolsCount":"22k","symbolsTime":"20 mins."},"categories":[{"name":"Unity","slug":"Unity","count":17,"path":"api/categories/Unity.json"},{"name":"Shader","slug":"Unity/Shader","count":7,"path":"api/categories/Unity/Shader.json"}],"tags":[{"name":"Unity","slug":"Unity","count":17,"path":"api/tags/Unity.json"},{"name":"Shader","slug":"Shader","count":33,"path":"api/tags/Shader.json"}],"author":{"name":"JBR_Bunjie","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/90251718?v=4","link":"/","description":"仿生程序员会在光环上遇见AI乐正绫吗？","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili-fill.svg","link":"https://space.bilibili.com/415377461"},"github":{"icon":"/svg/social_github.svg","link":"https://github.com/JBR-Bunjie"}}}}},"next_post":{"title":"Custom Right-Click Menu And Shader GUI排列","uid":"a21e0605e124236f924885120b82421a","slug":"Rendering/CustomRightClickMenuAndShaderGUI","date":"2023-04-10T08:32:30.000Z","updated":"2023-10-27T20:19:38.000Z","comments":true,"path":"api/articles/Rendering/CustomRightClickMenuAndShaderGUI.json","keywords":null,"cover":"https://raw.githubusercontent.com/JBR-Bunjie/JBR-Bunjie/main/back.jpg","text":"Custom Right-Click Menu And Shader GUI All the operations in this project should be done in a folder named &quot;Editor&quot;, no matter whe...","link":"","photos":[],"count_time":{"symbolsCount":"15k","symbolsTime":"14 mins."},"categories":[{"name":"Unity","slug":"Unity","count":17,"path":"api/categories/Unity.json"},{"name":"Shader","slug":"Unity/Shader","count":7,"path":"api/categories/Unity/Shader.json"}],"tags":[{"name":"Unity","slug":"Unity","count":17,"path":"api/tags/Unity.json"},{"name":"Shader","slug":"Shader","count":33,"path":"api/tags/Shader.json"}],"author":{"name":"JBR_Bunjie","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/90251718?v=4","link":"/","description":"仿生程序员会在光环上遇见AI乐正绫吗？","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili-fill.svg","link":"https://space.bilibili.com/415377461"},"github":{"icon":"/svg/social_github.svg","link":"https://github.com/JBR-Bunjie"}}}}}}