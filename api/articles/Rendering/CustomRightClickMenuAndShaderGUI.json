{"title":"Custom Right-Click Menu And Shader GUI排列","uid":"a21e0605e124236f924885120b82421a","slug":"Rendering/CustomRightClickMenuAndShaderGUI","date":"2023-04-10T08:32:30.000Z","updated":"2023-10-27T20:19:38.000Z","comments":true,"path":"api/articles/Rendering/CustomRightClickMenuAndShaderGUI.json","keywords":null,"cover":"https://raw.githubusercontent.com/JBR-Bunjie/JBR-Bunjie/main/back.jpg","content":"<h1 id=\"Custom-Right-Click-Menu-And-Shader-GUI\"><a href=\"#Custom-Right-Click-Menu-And-Shader-GUI\" class=\"headerlink\" title=\"Custom Right-Click Menu And Shader GUI\"></a>Custom Right-Click Menu And Shader GUI</h1><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>All the operations in this project should be done in a folder named &quot;Editor&quot;, no matter where this folder is though.</p></blockquote>\n<h2 id=\"What-do-we-want-to-do\"><a href=\"#What-do-we-want-to-do\" class=\"headerlink\" title=\"What do we want to do?\"></a>What do we want to do?</h2><p>we want to set up a custom file template in the right-click menu, so we can quickly create the files that we need.</p>\n<p>To archive this, we need to:</p>\n<ul>\n<li>Set up the file template</li>\n<li>Create C# Scripts which could be embedded into the editor to archive the file creating logic</li>\n</ul>\n<p>In this project, I will take the “URP Unlit Shader” as an example. And we will learn how to custom the shader ui later, too.</p>\n<h2 id=\"Set-up-a-template-for-shader\"><a href=\"#Set-up-a-template-for-shader\" class=\"headerlink\" title=\"Set up a template for shader\"></a>Set up a template for shader</h2><p>I will put a simple example to explain:</p>\n<pre class=\"line-numbers language-cpp\" data-language=\"cpp\"><code class=\"language-cpp\">Shader &quot;Custom URP Shader&#x2F;#NAME#&quot; &#123;\n    Properties &#123;&#125;\n    SubShader &#123;\n        Tags &#123;&quot;RenderType&quot; &#x3D; &quot;Opaque&quot; &quot;RenderPipeline&quot; &#x3D; &quot;UniversalPipeline&quot; &quot;Queue&quot; &#x3D; &quot;Geometry&quot;&#125;\n        Pass &#123;\n            Name &quot;ForwardLit&quot;\n            Tags &#123;&quot;LightMode&quot; &#x3D; &quot;UniversalForward&quot;&#125;\n\n            HLSLPROGRAM\n        \t#include &quot;Packages&#x2F;com.unity.render-pipelines.universal&#x2F;ShaderLibrary&#x2F;Core.hlsl&quot;\n            #pragma vertex vert\n            #pragma fragment frag\n\n            struct appdata &#123;...&#125;;\n            struct v2f &#123;...&#125;;\n\n            v2f vert(appdata v) &#123;...&#125;\n\n            half4 frag(v2f i): SV_Target &#123;...&#125;\n            ENDHLSL\n        &#125;\n    &#125;\n    CustomEditor &quot;ReArchiving.Editor.CreateURPShader&quot;\n&#125;</code></pre>\n\n<p>There are three important parts:</p>\n<ul>\n<li><code>Shader &quot;Custom URP Shader/#NAME#&quot;</code> in the first line, the <code>#NAME#</code> part will be replaced by the script with the file’s name.</li>\n<li><code>CustomEditor &quot;ReArchiving.Editor.CreateURPShader&quot;</code>, we use the <code>CustomEditor</code> command to archive the Custom UI of a single shader in the Inspector Tab. See: <a href=\"https://docs.unity3d.com/Manual/SL-CustomEditor.html\">Unity - Manual: ShaderLab: assigning a custom editor (unity3d.com)</a></li>\n<li>And the rest part is the entity, we can leave the template code here.</li>\n</ul>\n<h2 id=\"Custom-Shader-And-its-Tab\"><a href=\"#Custom-Shader-And-its-Tab\" class=\"headerlink\" title=\"Custom Shader And its Tab\"></a>Custom Shader And its Tab</h2><p>After defining the template, we need to define the control script!</p>\n<p>Here is the code:</p>\n<pre class=\"line-numbers language-csharp\" data-language=\"csharp\"><code class=\"language-csharp\">&#x2F;&#x2F; -----------------------------------------\n&#x2F;&#x2F; Base class named &#96;CreateCustomItemInMenu&#96;\n&#x2F;&#x2F; -----------------------------------------\nusing UnityEngine;\nusing UnityEditor;\nusing System.IO;\nusing System.Text;\nusing UnityEditor.ProjectWindowCallback;\nusing System.Text.RegularExpressions;\n\npublic class CreateCustomItemInMenu &#123;\n    public static string GetSelectedPathOrFallback() &#123;\n        string path &#x3D; &quot;Assets&quot;;\n\n        foreach (Object obj in Selection.GetFiltered(typeof(Object), SelectionMode.Assets)) &#123;\n            path &#x3D; AssetDatabase.GetAssetPath(obj);\n            if (!string.IsNullOrEmpty(path) &amp;&amp; File.Exists(path)) &#123;\n                path &#x3D; Path.GetDirectoryName(path);\n                break;\n            &#125;\n        &#125;\n\n        return path;\n    &#125;\n&#125;\n\n\nclass EndAction : EndNameEditAction &#123;\n    public override void Action(int instanceId, string pathName, string resourceFile) &#123;\n        Object o &#x3D; CreateScriptAssetFromTemplate(pathName, resourceFile);\n        ProjectWindowUtil.ShowCreatedAsset(o);\n    &#125;\n\n    private static Object CreateScriptAssetFromTemplate(string pathName, string resourceFile) &#123;\n        string fullPath &#x3D; Path.GetFullPath(pathName);\n        StreamReader streamReader &#x3D; new StreamReader(resourceFile);\n        string text &#x3D; streamReader.ReadToEnd(); &#x2F;&#x2F; read the template info\n        streamReader.Close();\n\n        string fileNameWithoutExtension &#x3D; Path.GetFileNameWithoutExtension(pathName);\n        text &#x3D; Regex.Replace(text, &quot;#NAME#&quot;, fileNameWithoutExtension); &#x2F;&#x2F; replace &#96;#NAME#&#96; in template and replace to filename\n\n        &#x2F;&#x2F; write the changed resources into the original file\n        bool encoderShouldEmitUTF8Identifier &#x3D; true;\n        bool throwOnInvalidBytes &#x3D; false;\n        UTF8Encoding encoding &#x3D; new UTF8Encoding(encoderShouldEmitUTF8Identifier, throwOnInvalidBytes);\n\n        bool append &#x3D; false;\n        StreamWriter streamWriter &#x3D; new StreamWriter(fullPath, append, encoding);\n\n        streamWriter.Write(text);\n        streamWriter.Close();\n        AssetDatabase.ImportAsset(pathName);\n\n        return AssetDatabase.LoadAssetAtPath(pathName, typeof(Object));\n    &#125;\n&#125;\n\n&#x2F;&#x2F; -----------------------------------------\n&#x2F;&#x2F; Base class named &#96;CreateURPShader&#96;\n&#x2F;&#x2F; -----------------------------------------\nusing UnityEditor;\nusing UnityEngine;\n\npublic class CreateURPShader : CreateCustomItemInMenu &#123;\n    private const string TemplatePath &#x3D; &quot;Assets&#x2F;CustomShaderGUI&#x2F;Editor&#x2F;Template&#x2F;URPShader.shader&quot;;\n\n    [MenuItem(&quot;Assets&#x2F;Create&#x2F;Shader&#x2F;URP Shader&quot;)]\n    public static void CreateFileFromTemplate() &#123;\n        ProjectWindowUtil.StartNameEditingIfProjectWindowExists(\n            0,\n            ScriptableObject.CreateInstance&lt;EndAction&gt;(),\n            GetSelectedPathOrFallback() + &quot;&#x2F;URPShader.shader&quot;,\n            null,\n            TemplatePath\n        );\n    &#125;\n&#125;</code></pre>\n\n<p>It’s important to divide the function into parts so that we can reuse and debug easier.</p>\n<p>And now you can see the template in the right-click menu:</p>\n<p><img src=\"/....%5Cimages%5CDev%5CUnity%5CArchives%5CCustomRightClickMenuAndShaderGUI%5C001.png\" alt=\"image-20230409172030993\"></p>\n<h2 id=\"Define-the-Shader-GUI\"><a href=\"#Define-the-Shader-GUI\" class=\"headerlink\" title=\"Define the Shader GUI\"></a>Define the Shader GUI</h2><p>We can directly use the built-in properties of unity to custom the GUI, see:</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p><a href=\"https://zhuanlan.zhihu.com/p/93194054\">Shader 面板上常用的一些内置枚举 UI - 知乎 (zhihu.com)</a> &gt; <a href=\"https://blog.csdn.net/candycat1992/article/details/51417965\">【Unity Shader】自定义材质面板的小技巧<em>unity shader bool</em>妈妈说女孩子要自立自强的博客-CSDN 博客</a></p></blockquote>\n<p>But here we choose to use scripts to custom the shader UI which is more powerful and flexible.</p>\n<p>Here is the basic framework I suggested:</p>\n<h3 id=\"Custom-Shader-GUI-Though-Scripts\"><a href=\"#Custom-Shader-GUI-Though-Scripts\" class=\"headerlink\" title=\"Custom Shader GUI Though Scripts\"></a>Custom Shader GUI Though Scripts</h3><h4 id=\"Setup-namespace\"><a href=\"#Setup-namespace\" class=\"headerlink\" title=\"Setup namespace:\"></a>Setup namespace:</h4><p>As for the start, we need to derive from an abstract class <code>ShaderGUI</code>.<br><a href=\"https://docs.unity3d.com/ScriptReference/ShaderGUI.html\">Unity - Scripting API: ShaderGUI (unity3d.com)</a></p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>Derive from this class for controlling how shader properties should be presented.</p>\n<p>For a shader to use this custom GUI, use the <code>CustomEditor</code> property in the shader. Note that <code>CustomEditor</code> can also be used for classes deriving from <code>MaterialEditor</code> (search for: <code>Custom Material Editors</code>). Note: Only the ShaderGUI approach works with Substance materials this is therefore the recommended approach to custom gui for shaders.</p></blockquote>\n<pre class=\"line-numbers language-c#\" data-language=\"c#\"><code class=\"language-c#\">namespace ReArchiving.Editor &#123;\n    public class SimpleShaderGUI : ShaderGUI &#123;\n        ...\n    &#125;\n&#125;</code></pre>\n\n<h4 id=\"Declare-variables\"><a href=\"#Declare-variables\" class=\"headerlink\" title=\"Declare variables\"></a>Declare variables</h4><p>In this section, we have three things to do:</p>\n<ul>\n<li>declare all the GUIContent which we want to show aside. Suggest defining this section with the name <code>GUIDescriptions</code>.</li>\n<li>declare all the strings which we have defined inside the target shader. We can define more strings than properties in the target shader itself because we have to do more operations before using these variables and we can exclude the properties that do not exist in the shader easily at that time. Suggest defining this section with the name <code>InsideMaterialProperties</code>.</li>\n<li>declare all the status variables. We use them to decide should corresponding variables be displayed.</li>\n</ul>\n<p>Here is the example code of this section:</p>\n<pre class=\"line-numbers language-c#\" data-language=\"c#\"><code class=\"language-c#\">      #region DataArea\n      private struct GUIDescriptions &#123;\n          &#x2F;&#x2F; Folder\n          public static readonly GUIContent SurfaceOptionFold &#x3D; new GUIContent(&quot;Surface Option Fold&quot;);\n\n          &#x2F;&#x2F; Material Properties\n          public static readonly GUIContent Test &#x3D; new GUIContent(&quot;Test&quot;);\n          public static readonly GUIContent MainTex &#x3D; new GUIContent(&quot;Main Texture&quot;);\n          public static readonly GUIContent MainColor &#x3D; new GUIContent(&quot;Main Color&quot;);\n      &#125;\n\n      private struct InsideMaterialProperties &#123;\n          public static readonly string Test &#x3D; &quot;_Test&quot;;\n          public static readonly string MainTex &#x3D; &quot;_MainTex&quot;;\n          public static readonly string MainColor &#x3D; &quot;_MainColor&quot;;\n      &#125;\n\n      &#x2F;&#x2F; After &#96;Styles&#96; and &#96;MporpertyNames&#96; were defined, we can then announce the variables for checking:\n      &#x2F;&#x2F; As you can see, we will use two data types here: one is the &#96;bool&#96; and another one is the &#96;MaterialProperty&#96;\n&#x2F;&#x2F; This is because we use the &#96;bool&#96; type to store the Foldout UI which is independent of Properties that are defined in Material\n&#x2F;&#x2F; And relatively, the &#96;MaterialProperties&#96; will store the Material related to Properties.\n      &#x2F;&#x2F; There is an exception though, that is the &#96;EditorPreKey&#96;, we use that to\n\n      &#x2F;&#x2F; &#96;EditorPreKey&#96;, we use this to store the foldout status(is this foldout opened or not)\n      private const string EditorPreKey &#x3D; &quot;ReArchiving:ShaderGUI:&quot;;\n\n      &#x2F;&#x2F; Foldout status\n      private bool m_SurfaceOptionsFoldout;\n\n      &#x2F;&#x2F; Properties\n      private MaterialProperty m_WorkflowModeProp;\n      private MaterialProperty m_Test;\n      private MaterialProperty m_MainTex;\n      private MaterialProperty m_MainColor;\n      #endregion</code></pre>\n\n<h4 id=\"Override-the-OnGUI-function\"><a href=\"#Override-the-OnGUI-function\" class=\"headerlink\" title=\"Override the OnGUI function:\"></a>Override the <code>OnGUI</code> function:</h4><p>Although we haven’t defined the other functions we need to use, we define the override <code>OnGUI</code> function here to help us clear the things we need to do.<br><a href=\"https://docs.unity3d.com/ScriptReference/ShaderGUI.OnGUI.html\">Unity - Scripting API: ShaderGUI.OnGUI (unity3d.com)</a></p>\n<p>So, what should we do here?</p>\n<p>We need to decide which property, GUIConent and type we want to show up in the Inspector tab. So we need to <strong>check the Usability of the properties</strong> and <strong>set them up</strong>. And that’s what we want to do.</p>\n<p>And, before we start coding, we’d better understand the <code>OnGUI</code> function. This function has two parameters: <code>MaterialEditor</code> and <code>MaterialProperty</code></p>\n<ul>\n<li><code>MaterialEditor</code>: The MaterialEditor that is calling this OnGUI (the ‘owner’). <a href=\"https://docs.unity3d.com/ScriptReference/MaterialEditor.html\">Unity - Scripting API: MaterialEditor (unity3d.com)</a></li>\n<li><code>MaterialProperty</code>: Material properties of the currently selected shader. <a href=\"https://docs.unity3d.com/ScriptReference/MaterialProperty.html\">Unity - Scripting API: MaterialProperty (unity3d.com)</a></li>\n</ul>\n<pre class=\"line-numbers language-csharp\" data-language=\"csharp\"><code class=\"language-csharp\">#region GUI\n&#x2F;&#x2F; To define a custom shader GUI use the methods of materialEditor to render controls for the properties array.\npublic override void OnGUI(MaterialEditor materialEditor, MaterialProperty[] properties) &#123;\n    &#x2F;&#x2F; Check the usability. Well, we will define the &#96;GetFoldoutState&#96; function later\n    m_SurfaceOptionsFoldout &#x3D; GetFoldoutState(&quot;SurfaceOptions&quot;);\n\n    &#x2F;&#x2F; https:&#x2F;&#x2F;docs.unity.cn&#x2F;cn&#x2F;2021.3&#x2F;ScriptReference&#x2F;ShaderGUI.FindProperty.html\n    &#x2F;&#x2F; Returns MaterialProperty if the material property was found, otherwise null.\n    m_Test &#x3D; FindProperty(MPropertyNames.Test, properties, false);\n    m_MainTex &#x3D; FindProperty(MPropertyNames.MainTex, properties, false);\n    m_MainColor &#x3D; FindProperty(MPropertyNames.MainColor, properties, false);\n\n    &#x2F;&#x2F; Modify and apply the custom GUI\n    EditorGUI.BeginChangeCheck(); &#x2F;&#x2F; https:&#x2F;&#x2F;docs.unity3d.com&#x2F;ScriptReference&#x2F;EditorGUI.BeginChangeCheck.html\n    DrawProperties(materialEditor);\n    &#x2F;&#x2F; if (EditorGUI.EndChangeCheck()) SetMaterialKeywords(materialEditor.target as Material);\n&#125;\n\n#endregion</code></pre>\n\n<p>As we have archived the usability check in the <code>OnGUI</code> function, we just need to archive the <code>DrawProperties()</code> function and <code>GetFoldoutState()</code> function later.</p>\n<h4 id=\"Archive-the-GetFoldoutState-function\"><a href=\"#Archive-the-GetFoldoutState-function\" class=\"headerlink\" title=\"Archive the GetFoldoutState function\"></a>Archive the <code>GetFoldoutState</code> function</h4><p>To archive the folder effects, we need to use the <code>EditorPrefs</code> Property to make the target variables a folder first.<br><a href=\"https://docs.unity3d.com/ScriptReference/EditorPrefs.html\">Unity - Scripting API: EditorPrefs (unity3d.com)</a></p>\n<pre class=\"line-numbers language-C#\" data-language=\"C#\"><code class=\"language-C#\">#region EditorPrefs\n\n&#x2F;&#x2F; Because we\nprivate bool GetFoldoutState(string name) &#123;\n    return EditorPrefs.GetBool($&quot;&#123;EditorPreKey&#125;.&#123;name&#125;&quot;);\n&#125;\n\nprivate void SetFoldoutState(string name, bool field, bool value) &#123;\n    if (field &#x3D;&#x3D; value) return;\n    EditorPrefs.SetBool($&quot;&#123;EditorPreKey&#125;.&#123;name&#125;&quot;, value);\n&#125;\n\n#endregion</code></pre>\n\n<h4 id=\"Setup-the-foldout-render-function\"><a href=\"#Setup-the-foldout-render-function\" class=\"headerlink\" title=\"Setup the foldout render function\"></a>Setup the foldout render function</h4><p>Finally, we will archive the function that can truly make effects in the Inspector tab.</p>\n<p>Here, we need to define a startup function that controls all the foldouts and then build different functions for every folder. It sounds like a big project. But it is a simple job actually.<br><a href=\"https://docs.unity3d.com/ScriptReference/EditorGUILayout.html\">Unity - Scripting API: EditorGUILayout (unity3d.com)</a><br><a href=\"https://docs.unity3d.com/ScriptReference/EditorGUILayout.BeginFoldoutHeaderGroup.html\">Unity - Scripting API: EditorGUILayout.BeginFoldoutHeaderGroup (unity3d.com)</a><br><a href=\"https://docs.unity3d.com/ScriptReference/EditorGUILayout.EndFoldoutHeaderGroup.html\">Unity - Scripting API: EditorGUILayout.EndFoldoutHeaderGroup (unity3d.com)</a></p>\n<pre class=\"line-numbers language-C#\" data-language=\"C#\"><code class=\"language-C#\">#region Properties\n\nprivate void DrawProperties(MaterialEditor materialEditor) &#123;\n    &#x2F;&#x2F; the foldout setup here:\n    var surfaceOptionsFold &#x3D;\n        EditorGUILayout.BeginFoldoutHeaderGroup(m_SurfaceOptionsFoldout, Styles.SurfaceOptionFold);\n    if (surfaceOptionsFold) &#123;\n        EditorGUILayout.Space();\n        DrawSurfaceOption(materialEditor);\n        EditorGUILayout.Space();\n    &#125;\n\n    SetFoldoutState(&quot;SurfaceOptions&quot;, m_SurfaceOptionsFoldout, surfaceOptionsFold);\n    EditorGUILayout.EndFoldoutHeaderGroup();\n&#125;\n\nprivate void DrawSurfaceOption(MaterialEditor materialEditor) &#123;\n    materialEditor.TexturePropertySingleLine(Styles.MainColor, m_MainTex, m_MainColor);\n\n    materialEditor.FloatProperty(m_Test, MPropertyNames.Test);\n&#125;\n\n#endregion</code></pre>\n\n<h4 id=\"Optional-Setup-keywords\"><a href=\"#Optional-Setup-keywords\" class=\"headerlink\" title=\"[Optional] Setup keywords\"></a>[Optional] Setup keywords</h4><p>Once we change the properties in the custom shader UI, we need to regenerate the corresponding shader variants. Here’s an example.</p>\n<pre class=\"line-numbers language-C#\" data-language=\"C#\"><code class=\"language-C#\">#region Keywords\n\nprivate void SetKeyword(Material material, string keyword, bool value) &#123;\n    if (value) material.EnableKeyword(keyword);\n    else material.DisableKeyword(keyword);\n&#125;\n\nprivate void SetMaterialKeywords(Material material) &#123;\n    &#x2F;&#x2F; https:&#x2F;&#x2F;docs.unity3d.com&#x2F;ScriptReference&#x2F;Material-shaderKeywords.html\n    material.shaderKeywords &#x3D; null;\n\n    SetKeyword(material, &quot;_SPECULAR_SETUP&quot;, material.GetFloat(MPropertyNames.Test) &#x3D;&#x3D; 0);\n&#125;\n\n#endregion</code></pre>\n\n<h3 id=\"A-Complete-Example-Script\"><a href=\"#A-Complete-Example-Script\" class=\"headerlink\" title=\"A Complete Example Script\"></a>A Complete Example Script</h3><p>Find it on: <a href=\"https://github.com/ChiliMilk/URP_Toon/blob/master/Assets/ChiliMilkToonShader/Editor/ToonShaderGUI.cs\">URP_Toon&#x2F;ToonShaderGUI.cs at master · ChiliMilk&#x2F;URP_Toon (github.com)</a></p>\n<h2 id=\"Reference\"><a href=\"#Reference\" class=\"headerlink\" title=\"Reference\"></a>Reference</h2><ul>\n<li><p>Blog:</p>\n<ul>\n<li><a href=\"https://github.com/Straw1997/UnityCustomShaderGUI\">Straw1997&#x2F;UnityCustomShaderGUI: 自定义 Unity Shader GUI (github.com)</a></li>\n<li><a href=\"https://forum.unity.com/threads/simplest-way-to-add-an-option-to-right-click-menu.424987/\">simplest way to add an option to right click menu - Unity Forum</a></li>\n<li><a href=\"https://www.runoob.com/csharp/csharp-enum.html\">C# 枚举（Enum） | 菜鸟教程 (runoob.com)</a></li>\n<li><a href=\"https://blog.csdn.net/candycat1992/article/details/51417965\">【Unity Shader】自定义材质面板的小技巧<em>unity shader bool</em>妈妈说女孩子要自立自强的博客-CSDN 博客</a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/93194054\">Shader 面板上常用的一些内置枚举 UI - 知乎 (zhihu.com)</a></li>\n</ul>\n</li>\n<li><p>Unity Manual</p>\n<ul>\n<li><a href=\"https://docs.unity3d.com/Manual/shader-keywords-material-inspector.html\">Unity - Manual: Using shader keywords with the material Inspector (unity3d.com)</a></li>\n<li><a href=\"https://docs.unity3d.com/Manual/SL-CustomEditor.html\">Unity - Manual: ShaderLab: assigning a custom editor (unity3d.com)</a></li>\n<li><a href=\"https://docs.unity3d.com/ScriptReference/ShaderGUI.OnGUI.html\">Unity - Scripting API: ShaderGUI.OnGUI (unity3d.com)</a></li>\n<li><a href=\"https://docs.unity3d.com/ScriptReference/MaterialEditor.html\">Unity - Scripting API: MaterialEditor (unity3d.com)</a></li>\n<li><a href=\"https://docs.unity3d.com/ScriptReference/MaterialProperty.html\">Unity - Scripting API: MaterialProperty (unity3d.com)</a></li>\n<li><a href=\"https://docs.unity3d.com/ScriptReference/EditorGUI.html\">Unity - Scripting API: EditorGUI (unity3d.com)</a></li>\n<li><a href=\"https://docs.unity3d.com/ScriptReference/EditorGUI.BeginChangeCheck.html\">Unity - Scripting API: EditorGUI.BeginChangeCheck (unity3d.com)</a></li>\n<li><a href=\"https://docs.unity3d.com/ScriptReference/EditorPrefs.html\">Unity - Scripting API: EditorPrefs (unity3d.com)</a></li>\n<li><a href=\"https://docs.unity3d.com/ScriptReference/EditorGUILayout.html\">Unity - Scripting API: EditorGUILayout (unity3d.com)</a></li>\n<li><a href=\"https://docs.unity3d.com/ScriptReference/EditorGUILayout.BeginFoldoutHeaderGroup.html\">Unity - Scripting API: EditorGUILayout.BeginFoldoutHeaderGroup (unity3d.com)</a></li>\n<li><a href=\"https://docs.unity3d.com/ScriptReference/EditorGUILayout.EndFoldoutHeaderGroup.html\">Unity - Scripting API: EditorGUILayout.EndFoldoutHeaderGroup (unity3d.com)</a></li>\n</ul>\n</li>\n<li><p><a href=\"https://github.com/ChiliMilk/URP_Toon/blob/master/Assets/ChiliMilkToonShader/Editor/ToonShaderGUI.cs\">URP_Toon&#x2F;ToonShaderGUI.cs at master · ChiliMilk&#x2F;URP_Toon (github.com)</a></p>\n</li>\n</ul>\n","text":"Custom Right-Click Menu And Shader GUI All the operations in this project should be done in a folder named &quot;Editor&quot;, no matter whe...","link":"","photos":[],"count_time":{"symbolsCount":"15k","symbolsTime":"14 mins."},"categories":[{"name":"Unity","slug":"Unity","count":17,"path":"api/categories/Unity.json"},{"name":"Shader","slug":"Unity/Shader","count":7,"path":"api/categories/Unity/Shader.json"}],"tags":[{"name":"Unity","slug":"Unity","count":17,"path":"api/tags/Unity.json"},{"name":"Shader","slug":"Shader","count":33,"path":"api/tags/Shader.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#Custom-Right-Click-Menu-And-Shader-GUI\"><span class=\"toc-text\">Custom Right-Click Menu And Shader GUI</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#What-do-we-want-to-do\"><span class=\"toc-text\">What do we want to do?</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Set-up-a-template-for-shader\"><span class=\"toc-text\">Set up a template for shader</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Custom-Shader-And-its-Tab\"><span class=\"toc-text\">Custom Shader And its Tab</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Define-the-Shader-GUI\"><span class=\"toc-text\">Define the Shader GUI</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Custom-Shader-GUI-Though-Scripts\"><span class=\"toc-text\">Custom Shader GUI Though Scripts</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#Setup-namespace\"><span class=\"toc-text\">Setup namespace:</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#Declare-variables\"><span class=\"toc-text\">Declare variables</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#Override-the-OnGUI-function\"><span class=\"toc-text\">Override the OnGUI function:</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#Archive-the-GetFoldoutState-function\"><span class=\"toc-text\">Archive the GetFoldoutState function</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#Setup-the-foldout-render-function\"><span class=\"toc-text\">Setup the foldout render function</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#Optional-Setup-keywords\"><span class=\"toc-text\">[Optional] Setup keywords</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#A-Complete-Example-Script\"><span class=\"toc-text\">A Complete Example Script</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Reference\"><span class=\"toc-text\">Reference</span></a></li></ol></li></ol>","author":{"name":"JBR_Bunjie","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/90251718?v=4","link":"/","description":"仿生程序员会在光环上遇见AI乐正绫吗？","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili-fill.svg","link":"https://space.bilibili.com/415377461"},"github":{"icon":"/svg/social_github.svg","link":"https://github.com/JBR-Bunjie"}}}},"mapped":true,"prev_post":{"title":"Mapcap","uid":"e381c275e6062a6db30ed6f89e560299","slug":"Rendering/Mapcap","date":"2023-04-29T04:23:23.000Z","updated":"2023-10-27T20:19:51.000Z","comments":true,"path":"api/articles/Rendering/Mapcap.json","keywords":null,"cover":"https://raw.githubusercontent.com/JBR-Bunjie/JBR-Bunjie/main/back.jpg","text":"What is Mapcap? MatCap is a method of light expression using pre-rendered images. This technique uses a picture of a sphere that represents ...","link":"","photos":[],"count_time":{"symbolsCount":"2.1k","symbolsTime":"2 mins."},"categories":[{"name":"Unity","slug":"Unity","count":17,"path":"api/categories/Unity.json"},{"name":"Shader","slug":"Unity/Shader","count":7,"path":"api/categories/Unity/Shader.json"}],"tags":[{"name":"Unity","slug":"Unity","count":17,"path":"api/tags/Unity.json"},{"name":"Shader","slug":"Shader","count":33,"path":"api/tags/Shader.json"}],"author":{"name":"JBR_Bunjie","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/90251718?v=4","link":"/","description":"仿生程序员会在光环上遇见AI乐正绫吗？","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili-fill.svg","link":"https://space.bilibili.com/415377461"},"github":{"icon":"/svg/social_github.svg","link":"https://github.com/JBR-Bunjie"}}}}},"next_post":{"title":"URP源码分析","uid":"23661fa8ae25c981d575d8f076eed3e1","slug":"Rendering/UpdateToURPPipeline/URPSourceCode","date":"2023-04-08T13:32:05.000Z","updated":"2023-10-27T20:19:19.000Z","comments":true,"path":"api/articles/Rendering/UpdateToURPPipeline/URPSourceCode.json","keywords":null,"cover":"https://raw.githubusercontent.com/JBR-Bunjie/JBR-Bunjie/main/back.jpg","text":"URP源码分析依赖信息： Editor版本：2021.21f1 LTS Shader版本：URP 12.1.10 URP Package总览首先，当我们下载URP资源时，我们的项目的Package中会出现这些内容： URP资源结构 - com.unity.render-pipel...","link":"","photos":[],"count_time":{"symbolsCount":"5.7k","symbolsTime":"5 mins."},"categories":[{"name":"Unity","slug":"Unity","count":17,"path":"api/categories/Unity.json"}],"tags":[{"name":"Unity","slug":"Unity","count":17,"path":"api/tags/Unity.json"},{"name":"Shader","slug":"Shader","count":33,"path":"api/tags/Shader.json"},{"name":"URP","slug":"URP","count":1,"path":"api/tags/URP.json"}],"author":{"name":"JBR_Bunjie","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/90251718?v=4","link":"/","description":"仿生程序员会在光环上遇见AI乐正绫吗？","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili-fill.svg","link":"https://space.bilibili.com/415377461"},"github":{"icon":"/svg/social_github.svg","link":"https://github.com/JBR-Bunjie"}}}}}}