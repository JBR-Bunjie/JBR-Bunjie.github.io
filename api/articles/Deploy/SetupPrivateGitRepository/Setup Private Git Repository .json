{"title":"私有Git仓库搭建","uid":"f859a0dc217f052fa5c43eafb964028a","slug":"Deploy/SetupPrivateGitRepository/Setup Private Git Repository ","date":"2021-10-05T03:05:03.000Z","updated":"2023-03-15T15:41:07.791Z","comments":true,"path":"api/articles/Deploy/SetupPrivateGitRepository/Setup Private Git Repository .json","keywords":null,"cover":"https://raw.githubusercontent.com/JBR-Bunjie/JBR-Bunjie/main/back.jpg","content":"<h1 id=\"云服务器上的私有git仓库搭建\">云服务器上的私有Git仓库搭建</h1>\r\n<hr />\r\n<h2 id=\"环境\">环境：</h2>\r\n<p>阿里云服务器CentOS7.6</p>\r\n<h2 id=\"部署git\">部署Git</h2>\r\n<h3 id=\"安装git\">安装Git：</h3>\r\n<h4 id=\"非centos安装git\">非CentOS安装Git：</h4>\r\n<p>绝大多数Linux发行版安装Git只需要一条命令——参看：<a href=\"#gitLinux\">Git官方指南</a></p>\r\n<h4 id=\"关于centos安装\">关于CentOS安装：</h4>\r\n<p>与绝大部分Linux系统不同，redhat发行的系统通过包管理工具yum最高只能安装到1.8.3版本，需要使用更高版本的话都只能通过源码编译安装</p>\r\n<blockquote>\r\n<p>Red Hat Enterprise Linux, Oracle Linux, CentOS, Scientific Linux, et\r\nal.</p>\r\n<p>RHEL and derivatives typically ship older versions of git. You can <a\r\nhref=\"#gitDownloadPage\">download a tarball</a> and build from source, or\r\nuse a 3rd-party repository such as <a href=\"#gitDownloadPage\">the IUS\r\nCommunity Project</a> to obtain a more recent version of git.</p>\r\n</blockquote>\r\n<h5 id=\"下载源码\">下载源码</h5>\r\n<p>首先我们先选择要安装的Git版本，我选择了2.33.0，下载并传到服务器上</p>\r\n<figure>\r\n<img src=\"../images/image-20211001150441411.png\"\r\nalt=\"image-20211001150441411\" />\r\n<figcaption aria-hidden=\"true\">image-20211001150441411</figcaption>\r\n</figure>\r\n<h5 id=\"解压编译安装\">解压，编译，安装</h5>\r\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"># 查看git版本\ngit --version\n \n# 卸载\n# yum remove git\nyum eras\n\n# 进入源码目录\n$ cd git-2.33.0\n\n# 安装工具和依赖\n$ yum install libcurl-devel\n$ yum install expat-devel\n$ yum install openssl-devel\n \n# 编译\n$ make prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;git all\n# 编译内容带&#x2F;usr&#x2F;locak&#x2F;git目录\n$ make prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;git install\n# 在&#x2F;usr&#x2F;local&#x2F;git目录完成安装，请注意，这个不是git的默认路径，所以我们还需要为git的bin中文件建立软连接到&#x2F;usr&#x2F;bin中</code></pre>\r\n<div class=\"tip\">\r\n<p>关于编译命令：make</p>\r\n<p>make all：编译所有的目标</p>\r\n<p>make install：安装已编译好的程序</p>\r\n<p>请注意！</p>\r\n<p>By default, <code>make install</code> will install all the files in\r\n<code>/usr/local/bin</code>, <code>/usr/local/lib</code> etc. You can\r\nspecify an installation prefix other than\r\n<code>/usr/local' using</code>--prefix', for instance\r\n<code>--prefix=$HOME</code></p>\r\n</div>\r\n<h5 id=\"添加到环境变量\">添加到环境变量</h5>\r\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"># 将git路径加入bashrc配置\n$ echo &quot;export PATH&#x3D;$PATH:&#x2F;usr&#x2F;local&#x2F;git&#x2F;bin&quot; &gt;&gt;&#x2F;etc&#x2F;bashrc\n \n# 应用bashrc\n$ source &#x2F;etc&#x2F;bashrc\n\n# 验证结果\n$ git --version\n# git version 2.33.0</code></pre>\r\n<h5 id=\"建立软连接\">建立软连接</h5>\r\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">ln -s &#x2F;usr&#x2F;local&#x2F;git&#x2F;bin&#x2F;git-upload-pack &#x2F;usr&#x2F;bin&#x2F;git-upload-pack\nln -s &#x2F;usr&#x2F;local&#x2F;git&#x2F;bin&#x2F;git-r-pack &#x2F;usr&#x2F;bin&#x2F;git-receive-pack\n# 一定要注意抓取地址和目标地址都要调换！\n# 如果没有在&#x2F;usr&#x2F;bin目录添加这两个文件的话，会因为没有处理请求的命令，报出没有权限的错</code></pre>\r\n<h3 id=\"创建仓库\">创建仓库：</h3>\r\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">cd &#x2F;home&#x2F;git # 进入git用户目录\n# 这个目录下会有三个以.记来隐藏的文件，请不要删除\n\n# 请以git用户的身份执行以下命令，否则还要执行修改用户目录权限的命令\n# 否则当客户端在以git身份执行clone等操作时会因为没有权限而失败\ngit init --bare yourRepositoryName.git # 这个命令有多个版本，如：git init yourRepositoryName.git, git init -bare youreRepositoryName.git 请注意区分</code></pre>\r\n<h3 id=\"在客户端克隆仓库\">在客户端克隆仓库：</h3>\r\n<pre class=\"line-numbers language-powershell\" data-language=\"powershell\"><code class=\"language-powershell\">git clone git@server-IP:&#x2F;home&#x2F;git&#x2F;test.git</code></pre>\r\n<p>完成！</p>\r\n<figure>\r\n<img\r\nsrc=\"../../../images/Deploy/SetupPrivateGitRepository/Git-image-20211003154821032.png\"\r\nalt=\"image-20211003154821032\" />\r\n<figcaption aria-hidden=\"true\">image-20211003154821032</figcaption>\r\n</figure>\r\n<h3 id=\"限制git用户登录\">限制git用户登录：</h3>\r\n<p>有的时候我们并不希望用户直接通过git用户的账号以及密码来直接通过SSH登录Linux主机，我们该怎么做？</p>\r\n<h4\r\nid=\"方法一禁止git用户通过ssh直接登录\">方法一：禁止Git用户通过ssh直接登录</h4>\r\n<p>但是很显然我们不能使用这种方法——当我们禁止Git用户登录时，绝大部分正常的Git操作包括git\r\nclone，git pull等都无法正常进行了</p>\r\n<h4 id=\"方法二禁止git用户进入bash\">方法二：禁止Git用户进入bash</h4>\r\n<p>编辑/etc/passwd这个文件，在文件末尾可以找到类似这样的行：</p>\r\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"># 原行： \ngit:x:1002:1002::&#x2F;home&#x2F;git:&#x2F;bin&#x2F;sh      \n----------------------------------------------------------\n# 更改为：\ngit:x:1002:1002::&#x2F;home&#x2F;git:&#x2F;usr&#x2F;bin&#x2F;git-shell</code></pre>\r\n<p>把/bin/sh改为/usr/bin/git-shell，这样git这个账户就只能用来克隆或者推送数据到git仓库中了，而不能用它来登录到主机。</p>\r\n<div class=\"tip\">\r\n<p>当我们引用git-shell时，我们仍然需要使用 <strong>ln</strong>\r\n命令来为我们安装于 /usr/local/git 下的文件创建软链接：</p>\r\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">ln -s &#x2F;usr&#x2F;local&#x2F;git&#x2F;bin&#x2F;git-shell &#x2F;usr&#x2F;bin&#x2F;git-shell</code></pre>\r\n</div>\r\n<p>重启服务器：</p>\r\n<p>之后，当我们再次通过git用户登录时，便会报：</p>\r\n<pre class=\"line-numbers language-powershell\" data-language=\"powershell\"><code class=\"language-powershell\">fatal: Interactive git shell is not enabled.\nhint: ~&#x2F;git-shell-commands should exist and have read and execute access.\nConnection to x.x.x.x closed.</code></pre>\r\n<h3 id=\"添加工作空间\">添加工作空间：</h3>\r\n<p>一般来讲，bare仓库不像是普通的仓库那样会在根目录中保存文件，bare仓库不保存文件并将.git文件夹下的全部内容直接暴露在当前仓库根目录中，且不包含工作区</p>\r\n<p>工作空间示例：</p>\r\n<figure>\r\n<img\r\nsrc=\"../../../images/Deploy/SetupPrivateGitRepository/Git-image-20211003155529616.png\"\r\nalt=\"image-20211003155529616\" />\r\n<figcaption aria-hidden=\"true\">image-20211003155529616</figcaption>\r\n</figure>\r\n<p>要查看工作空间，我们需要使用一个<a href=\"#hook\">钩子</a>：post-receive钩子</p>\r\n<p>有了这个钩子，我们要在裸仓库内看到用户提交的工作空间很简单了。只需要创建/编写post-receivek即可：</p>\r\n<p>在服务器裸仓库内</p>\r\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">cd hooks</code></pre>\r\n<p>创建并编辑post-receive</p>\r\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">vim post-receive</code></pre>\r\n<p>输入内容：</p>\r\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">#!&#x2F;bin&#x2F;sh\ngit --work-tree&#x3D;#工作空间# --git-dir&#x3D;#Git仓库地址# checkout -f</code></pre>\r\n<p>例如，我此处的配置是：</p>\r\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">#!&#x2F;bin&#x2F;sh\ngit --work-tree&#x3D;&#x2F;home&#x2F;git&#x2F;gitWorkspace&#x2F;testWorkspace --git-dir&#x3D;&#x2F;home&#x2F;git&#x2F;test.git checkout -f</code></pre>\r\n<ul>\r\n<li>工作空间：服务器上空目录地址，git用户需要有读写权限。</li>\r\n<li>Git仓库地址：服务器上本仓库地址。</li>\r\n</ul>\r\n<p>赋予执行权限：</p>\r\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">chmod +x post-receive\n# 用ls -alc</code></pre>\r\n<figure>\r\n<img\r\nsrc=\"../../../images/Deploy/SetupPrivateGitRepository/Git-image-20211003171322547.png\"\r\nalt=\"image-20211003171322547\" />\r\n<figcaption aria-hidden=\"true\">image-20211003171322547</figcaption>\r\n</figure>\r\n<p>之后，用户push提交后，–work-tree参数定义的工作空间就可以看到用户提交的具体内容：</p>\r\n<figure>\r\n<img\r\nsrc=\"../../../images/Deploy/SetupPrivateGitRepository/Git-image-20211003165533697.png\"\r\nalt=\"image-20211003165533697\" />\r\n<figcaption aria-hidden=\"true\">image-20211003165533697</figcaption>\r\n</figure>\r\n<hr />\r\n<h2 id=\"参考内容\">参考内容：</h2>\r\n<h3 id=\"教程中提到的webstie\">教程中提到的webstie</h3>\r\n<p><a href=\"https://git-scm.com/\">Git Website (git-scm.com)</a></p>\r\n<p><span id=\"gitLinux\"><a href=\"https://git-scm.com/download/linux\">Git\r\nDownload Page(git-scm.com)</a></span></p>\r\n<p><span id=\"gitDownloadPage\"><a\r\nhref=\"https://mirrors.edge.kernel.org/pub/software/scm/git/\">Index of\r\n/pub/software/scm/git/ (kernel.org)</a></span></p>\r\n<p><span id=\"IUS\"><a href=\"https://ius.io/\">IUS</a></span></p>\r\n<p><span id=\"hook\"><a\r\nhref=\"https://git-scm.com/book/zh/v2/自定义-Git-Git-钩子\">Git - Git 钩子\r\n(git-scm.com)</a></span></p>\r\n<h3 id=\"拓展资料\">拓展资料</h3>\r\n<p><a\r\nhref=\"http://htmlpreview.github.io/?https://github.com/sitaramc/sitaramc.github.com/blob/dce410b2a2804723676db9cabd7bb506b6d9ba05/concepts/bare.html\">all\r\nabout \"bare\" repos -- what, why, and how to fix a non-bare push\r\n(htmlpreview.github.io)</a></p>\r\n<p><a\r\nhref=\"https://stackoverflow.com/questions/37033032/where-are-the-files-in-a-bare-repository\">git\r\n- Where are the files in a bare repository? - Stack Overflow</a></p>\r\n<p><a\r\nhref=\"https://git-scm.com/book/en/v2/Git-on-the-Server-Getting-Git-on-a-Server\">Git\r\n- Getting Git on a Server (git-scm.com)</a></p>\r\n<p><a\r\nhref=\"https://stackoverflow.com/questions/20939430/accessing-files-of-a-repository-from-the-git-server\">Accessing\r\nfiles of a repository from the Git server - Stack Overflow</a></p>\r\n<iframe src=\"//player.bilibili.com/player.html?aid=932066812&amp;bvid=BV11M4y1N7q6&amp;cid=383208463&amp;page=1\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" width=\"100%\" height=\"500\" scrolling=\"no\" frameborder=\"0\" sandbox=\"allow-top-navigation allow-same-origin allow-forms allow-scripts\">\r\n</iframe>\r\n","text":"云服务器上的私有Git仓库搭建 环境： 阿里云服务器CentOS7.6 部署Git 安装Git： 非CentOS安装Git： 绝大多数Linux发行版安装Git只需要一条命令——参看：Git官方指南 关于CentOS安装： 与绝大部分Linux系统不同，redhat发行的系统通过...","link":"","photos":[],"count_time":{"symbolsCount":"4.2k","symbolsTime":"4 mins."},"categories":[{"name":"配置方法","slug":"配置方法","count":4,"path":"api/categories/配置方法.json"}],"tags":[{"name":"Git","slug":"Git","count":2,"path":"api/tags/Git.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E7%9A%84%E7%A7%81%E6%9C%89git%E4%BB%93%E5%BA%93%E6%90%AD%E5%BB%BA\"><span class=\"toc-text\">云服务器上的私有Git仓库搭建</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%8E%AF%E5%A2%83\"><span class=\"toc-text\">环境：</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%83%A8%E7%BD%B2git\"><span class=\"toc-text\">部署Git</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85git\"><span class=\"toc-text\">安装Git：</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E9%9D%9Ecentos%E5%AE%89%E8%A3%85git\"><span class=\"toc-text\">非CentOS安装Git：</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%85%B3%E4%BA%8Ecentos%E5%AE%89%E8%A3%85\"><span class=\"toc-text\">关于CentOS安装：</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%B8%8B%E8%BD%BD%E6%BA%90%E7%A0%81\"><span class=\"toc-text\">下载源码</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%A7%A3%E5%8E%8B%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85\"><span class=\"toc-text\">解压，编译，安装</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E6%B7%BB%E5%8A%A0%E5%88%B0%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F\"><span class=\"toc-text\">添加到环境变量</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%BB%BA%E7%AB%8B%E8%BD%AF%E8%BF%9E%E6%8E%A5\"><span class=\"toc-text\">建立软连接</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%88%9B%E5%BB%BA%E4%BB%93%E5%BA%93\"><span class=\"toc-text\">创建仓库：</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%9C%A8%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%85%8B%E9%9A%86%E4%BB%93%E5%BA%93\"><span class=\"toc-text\">在客户端克隆仓库：</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%99%90%E5%88%B6git%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95\"><span class=\"toc-text\">限制git用户登录：</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%96%B9%E6%B3%95%E4%B8%80%E7%A6%81%E6%AD%A2git%E7%94%A8%E6%88%B7%E9%80%9A%E8%BF%87ssh%E7%9B%B4%E6%8E%A5%E7%99%BB%E5%BD%95\"><span class=\"toc-text\">方法一：禁止Git用户通过ssh直接登录</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%96%B9%E6%B3%95%E4%BA%8C%E7%A6%81%E6%AD%A2git%E7%94%A8%E6%88%B7%E8%BF%9B%E5%85%A5bash\"><span class=\"toc-text\">方法二：禁止Git用户进入bash</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%B7%BB%E5%8A%A0%E5%B7%A5%E4%BD%9C%E7%A9%BA%E9%97%B4\"><span class=\"toc-text\">添加工作空间：</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8F%82%E8%80%83%E5%86%85%E5%AE%B9\"><span class=\"toc-text\">参考内容：</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%95%99%E7%A8%8B%E4%B8%AD%E6%8F%90%E5%88%B0%E7%9A%84webstie\"><span class=\"toc-text\">教程中提到的webstie</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%8B%93%E5%B1%95%E8%B5%84%E6%96%99\"><span class=\"toc-text\">拓展资料</span></a></li></ol></li></ol></li></ol>","author":{"name":"JBR_Bunjie","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/90251718?v=4","link":"/","description":"仿生程序员会在光环上遇见AI乐正绫吗？","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili-fill.svg","link":"https://space.bilibili.com/415377461"},"github":{"icon":"/svg/social_github.svg","link":"https://github.com/JBR-Bunjie"}}}},"mapped":true,"prev_post":{"title":"建立一个FTP服务器吧!","uid":"0ff372827a992c33dc9a7dba52ce9123","slug":"Deploy/FTPDeploy/FTP部署","date":"2021-10-05T03:07:03.000Z","updated":"2023-03-10T09:15:22.000Z","comments":true,"path":"api/articles/Deploy/FTPDeploy/FTP部署.json","keywords":null,"cover":"https://raw.githubusercontent.com/JBR-Bunjie/JBR-Bunjie/main/back.jpg","text":"建立一个FTP服务器吧！ 注意你所购买的云服务商的文档， 比如这里的： 主动模式：放通端口21。 被动模式：放通端口21，及 修改配置文件 中设置的 pasv_min_port 到 pasv_max_port 之间的所有端口，本文放通端口为40000 - 45000。 云服务器 ...","link":"","photos":[],"count_time":{"symbolsCount":"9.8k","symbolsTime":"9 mins."},"categories":[{"name":"配置方法","slug":"配置方法","count":4,"path":"api/categories/配置方法.json"}],"tags":[{"name":"FTP","slug":"FTP","count":2,"path":"api/tags/FTP.json"}],"author":{"name":"JBR_Bunjie","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/90251718?v=4","link":"/","description":"仿生程序员会在光环上遇见AI乐正绫吗？","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili-fill.svg","link":"https://space.bilibili.com/415377461"},"github":{"icon":"/svg/social_github.svg","link":"https://github.com/JBR-Bunjie"}}}}},"next_post":{"title":"Python编程入门","uid":"fc9433631750b4e2a27c5cd3c21a72be","slug":"Language Learning/Python/PythonBasicGrammar/PythonBasicGrammar","date":"2021-09-26T09:22:04.000Z","updated":"2023-03-10T09:09:55.000Z","comments":true,"path":"api/articles/Language Learning/Python/PythonBasicGrammar/PythonBasicGrammar.json","keywords":null,"cover":"https://raw.githubusercontent.com/JBR-Bunjie/JBR-Bunjie/main/back.jpg","text":"Python 3 Basic Grammar Training 为什么是python？ 一个最重要的原因——简单，快速，容易上手： 你也可以通过著名的开发语言排行榜TIOBE来直观感受Python有多么热门index | TIOBE - The Software Quality ...","link":"","photos":[],"count_time":{"symbolsCount":"10k","symbolsTime":"9 mins."},"categories":[{"name":"Programming Language Learning","slug":"Programming-Language-Learning","count":3,"path":"api/categories/Programming-Language-Learning.json"}],"tags":[{"name":"Python","slug":"Python","count":3,"path":"api/tags/Python.json"}],"author":{"name":"JBR_Bunjie","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/90251718?v=4","link":"/","description":"仿生程序员会在光环上遇见AI乐正绫吗？","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili-fill.svg","link":"https://space.bilibili.com/415377461"},"github":{"icon":"/svg/social_github.svg","link":"https://github.com/JBR-Bunjie"}}}}}}