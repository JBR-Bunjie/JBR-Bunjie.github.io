{"title":"建立一个FTP服务器吧!","uid":"0ff372827a992c33dc9a7dba52ce9123","slug":"Deploy/FTPDeploy/FTP部署","date":"2021-10-05T03:07:03.000Z","updated":"2023-03-10T09:15:22.000Z","comments":true,"path":"api/articles/Deploy/FTPDeploy/FTP部署.json","keywords":null,"cover":"https://raw.githubusercontent.com/JBR-Bunjie/JBR-Bunjie/main/back.jpg","content":"<h1 id=\"建立一个ftp服务器吧\">建立一个FTP服务器吧！</h1>\r\n<blockquote>\r\n<p>注意你所购买的云服务商的文档，</p>\r\n<p>比如这里的：</p>\r\n<blockquote>\r\n<ul>\r\n<li>主动模式：放通端口21。</li>\r\n<li>被动模式：放通端口21，及 <a\r\nhref=\"https://cloud.tencent.com/document/product/213/10912#config\">修改配置文件</a>\r\n中设置的 <code>pasv_min_port</code> 到 <code>pasv_max_port</code>\r\n之间的所有端口，本文放通端口为40000 - 45000。</li>\r\n</ul>\r\n<p><a\r\nhref=\"https://cloud.tencent.com/document/product/213/10912\">云服务器\r\nLinux 云服务器搭建 FTP 服务-最佳实践-文档中心-腾讯云\r\n(tencent.com)</a></p>\r\n</blockquote>\r\n<p><strong>Install vsftpd</strong></p>\r\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&gt;# Install\n&gt;sudo apt update\n&gt;sudo apt install vsftpd\n&gt;sudo cp &#x2F;etc&#x2F;vsftpd.conf &#x2F;etc&#x2F;vsftpd.conf.orig\n\n&gt;# Firwall rules\n&gt;sudo ufw allow ftp-data\n&gt;sudo ufw allow ftp\n&gt;sudo ufw status\n\n&gt;# Preparing Space for Files\n&gt;sudo mkdir -p mapftp\n&gt;sudo chown nobody:nogroup mapftp\n&gt;echo &quot;vsftpd test file&quot; | sudo tee mapftp&#x2F;test.log\n&gt;sudo mkdir mapftp&#x2F;maps&#x2F;\n&gt;sudo chmod a+rwx mapftp&#x2F;maps&#x2F;</code></pre>\r\n<p><strong>Configure Anonymous Access</strong></p>\r\n<ul>\r\n<li>Edit /etc/vsftpd.conf</li>\r\n<li>Change the following:</li>\r\n</ul>\r\n<ol type=\"1\">\r\n<li><code>anonymous_enable=YES</code> to allow anonymous access</li>\r\n<li><code>write_enable=YES</code> to enable uploading</li>\r\n<li><code>anon_upload_enable=YES</code> to enable anonymous\r\nuploading</li>\r\n<li><code>anon_mkdir_write_enable=YES</code> to enable anonymous\r\ndirectory creation</li>\r\n</ol>\r\n<ul>\r\n<li>Append the following to the end: 1.<code>anon_umask=022</code> so\r\nthat new file will be readable by groups and other users. Uploaded files\r\nwill have a permittion set to the value of <code>file_open_mode</code>\r\n(by default, 0666) subtracted by <code>anon_umask</code>.</li>\r\n</ul>\r\n<ol type=\"1\">\r\n<li><code>anon_other_write_enable=YES</code> to enable anonymous\r\ndeletion and renaming</li>\r\n<li><code>anon_root=xxx/mapftp</code> sets the root folder for anonymous\r\nlogins</li>\r\n<li><code>no_anon_password=YES</code> stops prompting for a password on\r\nthe command line.</li>\r\n<li><code>hide_ids=YES</code> shows the user and group as\r\n<code>ftp:ftp</code>, regardless of the owner.</li>\r\n<li><code>pasv_min_port=40000</code> and\r\n<code>pasv_max_port=50000</code> limits the range of ports that can be\r\nused for passive FTP</li>\r\n</ol>\r\n<ul>\r\n<li>Optionally changes the listening port:</li>\r\n</ul>\r\n<ol type=\"1\">\r\n<li><code>listen_port=</code> followed by port number</li>\r\n</ol>\r\n<p><strong>Conclusion</strong></p>\r\n<p>On Linux, use the ftp command to access the server, e.g.\r\n<code>ftp -p 192.168.0.2</code> then followed by <code>anonymous</code>\r\nas the username. On Windows, use Windows Explorer or other FTP\r\ntools.</p>\r\n</blockquote>\r\n<h2 id=\"了解ftp\">了解FTP</h2>\r\n<h3 id=\"什么是ftp\">什么是ftp？</h3>\r\n<p>FTP即：File Transfer\r\nProtocol，即ftp，可以直译为<strong>“文件传输协议”</strong>。但是由于FTP本身是使用明文进行数据传输，所以有了更多加密版本的FTP协议如：FTPS(FTP\r\nover SSL)，SFTP：Secure FTP(FTP over SSH)等</p>\r\n<h2 id=\"部署ftp服务器\">部署FTP服务器</h2>\r\n<h3\r\nid=\"以windows作为服务端filezilla实现\">以windows作为服务端——<a href=\"#filezilla\">filezilla</a>实现</h3>\r\n<p>推荐视频教程：<a\r\nhref=\"https://www.bilibili.com/video/BV1xv411k7Lj?from=search&amp;seid=6077142084469792314&amp;spm_id_from=333.337.0.0\">FileZilla：如何快速搭建FTP服务器</a></p>\r\n<ol type=\"1\">\r\n<li><p>Filezilla\r\nSever只支持Windows平台，而Client同时支持Windows，Linux，Mac</p></li>\r\n<li><p>设置Filezilla时需要注意：你添加的Port不是实际使用时的端口，是管理端口，所以不论设为什么值，只要不和当前系统已有端口重合都是可以的</p></li>\r\n<li><p>Filezilla使用多用户管理机制，不过你在正式使用之前需要先创建用户。在<code>Edit-User-general</code>中创建</p>\r\n<ul>\r\n<li>这个单个用户并不意味着是单个自然人，多个人是可以共享一个用户名和密码的，这里的用户主要是用于区分访问种类与权限而非界定访问的实际个人</li>\r\n<li>用户与用户之间可以设置不同目录来访问不同的资源：<code>shared folders</code>中管理，但是每一个用户都需要一个根目录</li>\r\n<li>当你添加一个非根目录的时候，需要手动指定它在访问时所在的目录——即电脑本地的文件路径和访问到的文件路径并不是不统一的。但是根目录是无需指定路径的，或者说根目录的路径是<code>/</code></li>\r\n<li>注意用户的权限管理，记得设置用户密码</li>\r\n</ul></li>\r\n<li><p>home会占用网址的路径，它不需要指定路径，对于home外的目录，添加之后，需要指定新的路径</p>\r\n<ul>\r\n<li><p>需要注意的是，ftp服务中的添加的目录与本机文件的实际目录是可以没有关系的</p>\r\n<p>​\r\n例如，对两个同级目录，你可以将一个目录赋在另一个目录的路径的子路径中</p></li>\r\n<li><p>配置路径地址时，注意使用反斜杠</p></li>\r\n</ul></li>\r\n</ol>\r\n<h3 id=\"以linux作为服务端vsftpd实现\">以Linux作为服务端——vsftpd实现</h3>\r\n<h4 id=\"在云服务器上部署ftp服务\">在云服务器上部署ftp服务</h4>\r\n<p>这里采用了阿里云服务器的CentOS7系统，版本是7.6</p>\r\n<p>使用了常用的vsftpd包来搭建ftp服务</p>\r\n<p>vsftpd项目地址：<a\r\nhref=\"https://security.appspot.com/vsftpd.html\">vsftpd - Secure, fast\r\nFTP server for UNIX-like systems (security.appspot.com)</a></p>\r\n<section id=\"安装ftp服务\" class=\"warning\">\r\n<h5>安装ftp服务</h5>\r\n<p>请注意，本文可能仅适用于CentOS，其他的Linux发行版与CentOS虽同为Linux系统，但是也有诸多不同</p>\r\n<p>例如，第5步需要修改的vsftpd.conf文件，CentOS系统下它会出现在\r\n/etc/vsftpd 文件夹下，而Ubuntu系统下它则会直接出现在 /etc 文件夹下</p>\r\n<p>如果你需要以本教程做参考的话，请不要照搬本教程。比如将CentOS的包管理工具yum替换为你当前Linux发行版下的包管理工具</p>\r\n</section>\r\n<ol type=\"1\">\r\n<li>安装vsftpd</li>\r\n</ol>\r\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">yum install -y vsftpd</code></pre>\r\n<ol start=\"2\" type=\"1\">\r\n<li>设置vsftpd开机启动</li>\r\n</ol>\r\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">systemctl enable vsftpd</code></pre>\r\n<ol start=\"3\" type=\"1\">\r\n<li>启动vsftpd服务</li>\r\n</ol>\r\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">systemctl start vsftpd</code></pre>\r\n<ol start=\"4\" type=\"1\">\r\n<li>检验服务是否启动</li>\r\n</ol>\r\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">netstat -antup | grep ftp</code></pre>\r\n<h5 id=\"配置vsftpd\">配置vsftpd</h5>\r\n<h6 id=\"建立用户并为他配置用户专属文件夹\"><span\r\nid=\"usernameAndCode\">建立用户并为他配置用户专属文件夹</span></h6>\r\n<ol type=\"1\">\r\n<li><p>执行以下命令，为 FTP 服务创建一个 Linux 用户，本文以 ftpuser\r\n为例。</p>\r\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">useradd ftpuser</code></pre>\r\n<p>当你创建了一个新的用户的时候，Linux回味这个用户在 <code>/home</code>\r\n目录下建立一个以用户名为名的文件夹，并且这个目录这就是此后用户登陆时的默认路径\r\n<code>~</code>所代指的路径</p></li>\r\n<li><p>执行以下命令，设置 <code>ftpuser</code> 用户的密码。</p>\r\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">passwd ftpuser</code></pre>\r\n<p>输入密码后请按Enter确认设置，密码默认不显示，本文以JBRBunjie为例。</p></li>\r\n<li><p>执行以下命令，创建 FTP\r\n服务使用的文件目录，本文以/var/ftp/test为例。</p>\r\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">mkdir &#x2F;var&#x2F;ftp&#x2F;test</code></pre>\r\n<div class=\"tip\">\r\n<p>事实上，这个目录是哪里都可以的。只是一定要记得这个目录路径是什么，因为这个路径过会儿是会写入配置文件的。当客户机访问服务器时，实际地址就是这个地址</p>\r\n</div></li>\r\n<li><p>执行以下命令，修改目录权限。</p>\r\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">chown -R ftpuser:ftpuser &#x2F;var&#x2F;ftp&#x2F;test</code></pre>\r\n<blockquote>\r\n<p>你也可以直接新开一个终端，并以ftpuser身份登录</p>\r\n<p>这样子可以省去很多没必要的麻烦，因为在ftpuser身份下创建的所以文件的owner都是ftpuser，就可以省略用户权限配置这一步</p>\r\n</blockquote></li>\r\n</ol>\r\n<h6\r\nid=\"修改vsftpd.conf配置文件并设置chroot\">修改vsftpd.conf配置文件，并设置chroot</h6>\r\n<ol type=\"1\">\r\n<li><p>打开要修改的文件：</p>\r\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">vim &#x2F;etc&#x2F;vsftpd&#x2F;vsftpd.conf</code></pre></li>\r\n<li><p>按<code>i</code>切换至编辑模式以修改配置文件vsftpd.conf：</p></li>\r\n</ol>\r\n<blockquote>\r\n<p>注意：</p>\r\n<p>FTP\r\n可通过主动模式和被动模式与客户端机器进行连接并传输数据。由于大多数客户端机器的防火墙设置及无法获取真实\r\nIP 等原因，一般选择<strong>被动模式</strong>搭建 FTP\r\n服务。以下修改以设置被动模式为例，如需选择主动模式，可以参看腾讯云的文档：<a\r\nhref=\"https://cloud.tencent.com/document/product/213/10912#port\">设置\r\nFTP 主动模式</a>。</p>\r\n</blockquote>\r\n<ol start=\"3\" type=\"1\">\r\n<li><p>修改以下配置参数，取消它们前面的<code>#</code>注释或者修改对应值，和本地用户的登录权限，设置指定例外用户列表文件的路径，并开启监听\r\nIPv4 sockets。</p>\r\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"># Allow anonymous FTP? (Beware - allowed by default if you comment this out).\n# 是否运行匿名用户登录\nanonymous_enable&#x3D;NO\n\n# Uncomment this to allow local users to log in.\n# When SELinux is enforcing check for SE bool ftp_home_dir\n# 取消此注释来运行本地用户登录\nlocal_enable&#x3D;YES\n\n# You may specify an explicit list of local users to chroot() to their home directory. If chroot_local_user is YES, then this list becomes a list of users to NOT chroot(). (Warning! chroot&#39;ing can be very dangerous. If using chroot, make sure that the user does not have write access to the top level directory within the chroot)\n# 如果两个配置项都为yes，那么, 凡是加在文件chroot_list中的用户都是不受限止的用户，即, 可以浏览其主目录的上级目录.\n# 如果不希望某用户能够浏览其主目录上级目录中的内容,可以如上设置,然后在文件vsftpd.chroot_list中去掉或不添加该用户即可。\n\n# 也可以如下配置\n# chroot_local_user＝NO\n# chroot_list_enable&#x3D;YES(这行必须要有, 否则文件vsftpd.chroot_list不会起作用)\n# 则所有用户都能够访问上级目录，你可以把所有不希望有这种浏览其主目录之上的各目录权限的用户添加到文件chroot_list中即可(一行一个用户名，此时, 在该文件中的用户都是不可以浏览其主目录之外的目录的)\nchroot_local_user&#x3D;YES\nchroot_list_enable&#x3D;YES\n# chroot_list路径\nchroot_list_file&#x3D;&#x2F;etc&#x2F;vsftpd&#x2F;chroot_list\n\n# When &quot;listen&quot; directive is enabled, vsftpd runs in standalone mode and\n# listens on IPv4 sockets. This directive cannot be used in conjunction\n# with the listen_ipv6 directive.\n# 监听IPv4 sockets\nlisten&#x3D;YES</code></pre></li>\r\n<li><p>在<code>listen_ipv6=YES</code>行首添加<code>#</code>来将此功能注释掉</p>\r\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"># This directive enables listening on IPv6 sockets. By default, listening\n# on the IPv6 &quot;any&quot; address (::) will accept connections from both IPv6\n# and IPv4 clients. It is not necessary to listen on *both* IPv4 and IPv6\n# sockets. If you want that (perhaps because you want to listen on specific\n# addresses) then you must run two copies of vsftpd with two configuration\n# files.\n# Make sure, that one of the listen options is commented !!\n\n# 关闭监听 IPv6 sockets。\n# listen_ipv6&#x3D;YES</code></pre></li>\r\n<li><p>添加以下配置参数，开启被动模式，设置本地用户登录后所在目录，以及云服务器建立数据传输可使用的端口范围值</p>\r\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">local_root&#x3D;&#x2F;var&#x2F;ftp&#x2F;test\nallow_writeable_chroot&#x3D;YES\npasv_enable&#x3D;YES\npasv_address&#x3D;xxx.xx.xxx.xx #请修改为您的 Linux 云服务器公网 IP\npasv_min_port&#x3D;40000\npasv_max_port&#x3D;45000</code></pre>\r\n<p>按 <code>Esc</code> 后输入 <code>:wq!</code> 保存后退出。</p></li>\r\n<li><p><span\r\nid=\"continue-steps\">创建<code>chroot_list</code>文件</span></p>\r\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">vim &#x2F;etc&#x2F;vsftpd&#x2F;chroot_list</code></pre>\r\n<ul>\r\n<li><p>按 <strong>i</strong>\r\n进入编辑模式，输入用户名，一个用户名占据一行，</p></li>\r\n<li><p>设置完成后按 <strong>Esc</strong> 并输入 <strong>:wq</strong>\r\n保存后退出。</p></li>\r\n<li><p>您若没有设置例外用户的需求，可跳过此步骤，输入\r\n<strong>:wq</strong> 退出文件。或者直接改用 <code>touch</code>\r\n命令来创建文件</p></li>\r\n</ul></li>\r\n<li><p>重启 FTP 服务。</p>\r\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">systemctl restart vsftpd</code></pre></li>\r\n</ol>\r\n<h5 id=\"设置云服务器安全组\">设置云服务器安全组</h5>\r\n<p>增加新的策略：</p>\r\n<ol type=\"1\">\r\n<li>开放ftp 21端口</li>\r\n<li>开放你在vsftpd.config中所配置的端口范围(pasv_min_port -\r\npasv_max_port) 40000 - 45000</li>\r\n</ol>\r\n<p>示例：</p>\r\n<figure>\r\n<img\r\nsrc=\"../../../images/Deploy/FTPDeploy/FTPimage-20211002181804382.png\"\r\nalt=\"image-20211002181804382\" />\r\n<figcaption aria-hidden=\"true\">image-20211002181804382</figcaption>\r\n</figure>\r\n<div class=\"tip\">\r\n<p>如果你使用的不是云服务器，你只需要将本地的防火墙指定端口打开就行</p>\r\n</div>\r\n<h5 id=\"验证-ftp-服务\">验证 FTP 服务</h5>\r\n<p>您可通过 FTP 客户端软件、浏览器或文件资源管理器等工具验证 FTP\r\n服务。</p>\r\n<ol type=\"1\">\r\n<li><p>打开客户端的 IE 浏览器，选择【工具】&gt;【Internet\r\n选项】&gt;【高级】，根据您选择的 FTP 模式进行修改：</p>\r\n<ul>\r\n<li><p>主动模式：取消勾选【使用被动 FTP】</p></li>\r\n<li><p>被动模式：勾选【使用被动 FTP】</p>\r\n<figure>\r\n<img\r\nsrc=\"../../../images/Deploy/FTPDeploy/FTP-image-20211002180657770.png\"\r\nalt=\"image-20211002180657770\" />\r\n<figcaption aria-hidden=\"true\">image-20211002180657770</figcaption>\r\n</figure></li>\r\n</ul></li>\r\n<li><p>打开计算机的ftp客户端，如果是windows电脑可以直接使用<code>file explorer</code>，在路径栏中访问\"ftp://xxx.xxx.xxx.xxx（你服务器的地址）\"</p></li>\r\n<li><p>在弹出的“登录身份”窗口中输入 <a href=\"#usernameAndCode\">配置\r\nvsftpd</a> 中已设置的用户名及密码。本文使用的用户名为\r\n<code>ftpuser</code>，密码为 <code>JBRBunjie</code></p></li>\r\n<li><p>成功登录后，即可上传及下载文件</p></li>\r\n</ol>\r\n<h4\r\nid=\"更进一步为多用户配置不同根目录\">更进一步：为多用户配置不同根目录</h4>\r\n<p><del>埋坑</del></p>\r\n<p><strong>总之仍然是对vsftpd配置文件进行修改来实现</strong></p>\r\n<hr />\r\n<h2 id=\"踩坑集合\">踩坑集合</h2>\r\n<h3 id=\"linux-系统环境下\">Linux 系统环境下</h3>\r\n<h4\r\nid=\"no-such-file-or-directory-550-create-directory-operation-failed\">550\r\nNo such file or directory / 550 create directory operation failed</h4>\r\n<p>查看当前用户：</p>\r\n<p>如果你能连上远程地址，但是根本看不到文件内容，并且当你输入正确密码时仍然报错：550</p>\r\n<p>建议排查的东西：</p>\r\n<ul>\r\n<li><p>你配置的目录是否正确：<code>/etc/vsftpd/vsftpd.conf</code> 中的\r\n<code>local_root</code> 是否是你实际配置的目录</p></li>\r\n<li><p><code>ftpuser</code> 是否拥有操作当前\r\n<code>local_root=/var/ftp/test</code> 目录及内层文件的权限</p>\r\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">ls -l [option: existed folder in current menu]</code></pre></li>\r\n<li><p>服务是否启动</p>\r\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">netstat -antup | grep ftp</code></pre></li>\r\n<li><p>修改了配置项但还没有重启服务</p>\r\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">systemctl restart vsftpd</code></pre></li>\r\n<li><p>检查SELinux服务：</p>\r\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">getsebool -a | grep ftp</code></pre>\r\n<p>如果这条语句的结果是</p>\r\n<figure>\r\n<img\r\nsrc=\"../../../images/Deploy/FTPDeploy/image-20210918235447255-16319804884733.png\"\r\nalt=\"image-20210918235447255\" />\r\n<figcaption aria-hidden=\"true\">image-20210918235447255</figcaption>\r\n</figure>\r\n<p>代表SELinux安全服务处于disabled状态，不是这里的错，大概率还是上面四条错误</p>\r\n<p>但是如果是下面这样</p></li>\r\n</ul>\r\n<figure>\r\n<img\r\nsrc=\"../../../images/Deploy/FTPDeploy/image-20210918235240645-16319803627632.png\"\r\nalt=\"image-20210918235240645\" />\r\n<figcaption aria-hidden=\"true\">image-20210918235240645</figcaption>\r\n</figure>\r\n<p>​ ——几乎所有与ftp相关的服务都被关闭掉了</p>\r\n<p>​ 那几乎可以肯定是在这里出错了</p>\r\n<p>​ 解决办法是修改/etc/selinux/config配置文件：</p>\r\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">vim &#x2F;etc&#x2F;selinux&#x2F;config</code></pre>\r\n<p>​\r\n把<code>SELINUX</code>默认的<code>permissive</code>或<code>enforcing</code>改为<code>disabled</code></p>\r\n<figure>\r\n<img\r\nsrc=\"../../../images/Deploy/FTPDeploy/image-20210918235654741-16319806164524.png\"\r\nalt=\"image-20210918235654741\" />\r\n<figcaption aria-hidden=\"true\">image-20210918235654741</figcaption>\r\n</figure>\r\n<div class=\"tip\">\r\n<p>什么是<a href=\"#SELinux\">SELinux</a>？</p>\r\n<p>Security-Enhanced Linux (SELinux) is a security architecture for\r\n<a href=\"#what-is-linux\">Linux® systems</a> that allows administrators\r\nto have more control over who can access the system. It was originally\r\ndeveloped by the United States National Security Agency (NSA) as a\r\nseries of patches to the <a href=\"#linux-kernel\">Linux kernel</a> using\r\nLinux Security Modules (LSM).</p>\r\n<p>SELinux was released to the open source community in 2000, and was\r\nintegrated into the upstream Linux kernel in 2003.</p>\r\n<blockquote>\r\n<p>\" SELinux(Security-Enhanced Linux)\r\n是美国国家安全局（NSA）对于强制访问控制的实现，是\r\nLinux历史上最杰出的新安全子系统 \"</p>\r\n</blockquote>\r\n</div>\r\n<ul>\r\n<li>最后办法：重启计算机，因为你之前修改的配置文件可能并没有生效</li>\r\n</ul>\r\n<h4 id=\"could-not-create-file\">553 Could not create file</h4>\r\n<p>解决方法</p>\r\n<ol type=\"1\">\r\n<li><p>执行以下命令，检查服务器磁盘空间的使用率。</p>\r\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">df -h</code></pre>\r\n<ul>\r\n<li>如果磁盘空间不足，将会导致文件无法上传，建议删除磁盘容量较大的文件。</li>\r\n<li>如果磁盘空间正常，请执行下一步。</li>\r\n</ul></li>\r\n<li><p>执行以下命令，检查 FTP 目录是否有写的<strong>权限</strong>。</p>\r\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">ls -l &#x2F;home&#x2F;test      \n# &#x2F;home&#x2F;test 为 FTP 目录，请修改为您实际的 FTP 目录。</code></pre>\r\n<ul>\r\n<li>若返回结果中没有\r\n<code>w</code>，则表示该用户没有写的权限，请执行下一步。</li>\r\n<li>若返回结果中已有 <code>w</code>，(⊙﹏⊙)，那我建议你重装系统（</li>\r\n</ul></li>\r\n<li><p>执行以下命令，对 FTP 目录加上写的权限。</p>\r\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">chmod +w &#x2F;home&#x2F;test \n# &#x2F;home&#x2F;test 为 FTP 目录，请修改为您实际的 FTP 目录。</code></pre></li>\r\n<li><p>执行以下命令，重新检查写的权限是否设置成功。</p>\r\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">ls -l &#x2F;home&#x2F;test   \n# &#x2F;home&#x2F;test 为 FTP 目录，请修改为您实际的 FTP 目录。</code></pre></li>\r\n</ol>\r\n<h3 id=\"设置-ftp-主动模式\">设置 FTP 主动模式</h3>\r\n<p>主动模式需修改的配置如下，其余配置保持默认设置：</p>\r\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">anonymous_enable&#x3D;NO      #禁止匿名用户登录\n\nlocal_enable&#x3D;YES         #支持本地用户登录\n\nchroot_local_user&#x3D;YES    #全部用户被限制在主目录\nchroot_list_enable&#x3D;YES   #启用例外用户名单\nchroot_list_file&#x3D;&#x2F;etc&#x2F;vsftpd&#x2F;chroot_list  #指定用户列表文件，该列表中的用户不被锁定在主目录\n\nlisten&#x3D;YES               #监听IPv4 sockets\n\n#在行首添加#注释掉以下参数\n#listen_ipv6&#x3D;YES         #关闭监听IPv6 sockets\n\n#添加下列参数\nallow_writeable_chroot&#x3D;YES\nlocal_root&#x3D;&#x2F;var&#x2F;ftp&#x2F;test #设置本地用户登录后所在的目录</code></pre>\r\n<p>按 <strong>Esc</strong> 后输入 <strong>:wq</strong>\r\n保存后退出，并前往<a href=\"#continue-steps\">这里</a>&gt;继续完成 vsftpd\r\n配置。</p>\r\n<h2 id=\"参考资料\">参考资料：</h2>\r\n<h3 id=\"部分资源与拓展阅读\">部分资源与拓展阅读</h3>\r\n<p><a href=\"https://filezilla-project.org/\">FileZilla - The free FTP\r\nsolution (filezilla-project.org)</a></p>\r\n<p><span id=\"SELinux\"><a\r\nhref=\"https://www.redhat.com/en/topics/linux/what-is-selinux\">What is\r\nSELinux? (redhat.com)</a></span></p>\r\n<p><span id=\"what-is-linux\"><a\r\nhref=\"https://www.redhat.com/en/topics/linux/what-is-linux\">What is\r\nLinux? (redhat.com)</a></span></p>\r\n<p><span\r\nid=\"linux-kernel\">https://www.redhat.com/en/topics/linux/what-is-the-linux-kernel</span></p>\r\n<h3 id=\"进一步配置\">进一步配置：</h3>\r\n<p><a\r\nhref=\"https://cloud.tencent.com/developer/article/1447057\">vsftpd添加用户并分配不同权限\r\n- 云+社区 - 腾讯云 (tencent.com)</a></p>\r\n","text":"建立一个FTP服务器吧！ 注意你所购买的云服务商的文档， 比如这里的： 主动模式：放通端口21。 被动模式：放通端口21，及 修改配置文件 中设置的 pasv_min_port 到 pasv_max_port 之间的所有端口，本文放通端口为40000 - 45000。 云服务器 ...","link":"","photos":[],"count_time":{"symbolsCount":"9.8k","symbolsTime":"9 mins."},"categories":[{"name":"配置方法","slug":"配置方法","count":4,"path":"api/categories/配置方法.json"}],"tags":[{"name":"FTP","slug":"FTP","count":2,"path":"api/tags/FTP.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%BB%BA%E7%AB%8B%E4%B8%80%E4%B8%AAftp%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%90%A7\"><span class=\"toc-text\">建立一个FTP服务器吧！</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BA%86%E8%A7%A3ftp\"><span class=\"toc-text\">了解FTP</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BB%80%E4%B9%88%E6%98%AFftp\"><span class=\"toc-text\">什么是ftp？</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%83%A8%E7%BD%B2ftp%E6%9C%8D%E5%8A%A1%E5%99%A8\"><span class=\"toc-text\">部署FTP服务器</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BB%A5windows%E4%BD%9C%E4%B8%BA%E6%9C%8D%E5%8A%A1%E7%AB%AFfilezilla%E5%AE%9E%E7%8E%B0\"><span class=\"toc-text\">以windows作为服务端——filezilla实现</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BB%A5linux%E4%BD%9C%E4%B8%BA%E6%9C%8D%E5%8A%A1%E7%AB%AFvsftpd%E5%AE%9E%E7%8E%B0\"><span class=\"toc-text\">以Linux作为服务端——vsftpd实现</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%9C%A8%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E9%83%A8%E7%BD%B2ftp%E6%9C%8D%E5%8A%A1\"><span class=\"toc-text\">在云服务器上部署ftp服务</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85ftp%E6%9C%8D%E5%8A%A1\"><span class=\"toc-text\">安装ftp服务</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AEvsftpd\"><span class=\"toc-text\">配置vsftpd</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#%E5%BB%BA%E7%AB%8B%E7%94%A8%E6%88%B7%E5%B9%B6%E4%B8%BA%E4%BB%96%E9%85%8D%E7%BD%AE%E7%94%A8%E6%88%B7%E4%B8%93%E5%B1%9E%E6%96%87%E4%BB%B6%E5%A4%B9\"><span class=\"toc-text\">建立用户并为他配置用户专属文件夹</span></a></li><li class=\"toc-item toc-level-6\"><a class=\"toc-link\" href=\"#%E4%BF%AE%E6%94%B9vsftpd.conf%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%B9%B6%E8%AE%BE%E7%BD%AEchroot\"><span class=\"toc-text\">修改vsftpd.conf配置文件，并设置chroot</span></a></li></ol></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E8%AE%BE%E7%BD%AE%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%89%E5%85%A8%E7%BB%84\"><span class=\"toc-text\">设置云服务器安全组</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E9%AA%8C%E8%AF%81-ftp-%E6%9C%8D%E5%8A%A1\"><span class=\"toc-text\">验证 FTP 服务</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%9B%B4%E8%BF%9B%E4%B8%80%E6%AD%A5%E4%B8%BA%E5%A4%9A%E7%94%A8%E6%88%B7%E9%85%8D%E7%BD%AE%E4%B8%8D%E5%90%8C%E6%A0%B9%E7%9B%AE%E5%BD%95\"><span class=\"toc-text\">更进一步：为多用户配置不同根目录</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%B8%A9%E5%9D%91%E9%9B%86%E5%90%88\"><span class=\"toc-text\">踩坑集合</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#linux-%E7%B3%BB%E7%BB%9F%E7%8E%AF%E5%A2%83%E4%B8%8B\"><span class=\"toc-text\">Linux 系统环境下</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#no-such-file-or-directory-550-create-directory-operation-failed\"><span class=\"toc-text\">550\r\nNo such file or directory &#x2F; 550 create directory operation failed</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#could-not-create-file\"><span class=\"toc-text\">553 Could not create file</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%AE%BE%E7%BD%AE-ftp-%E4%B8%BB%E5%8A%A8%E6%A8%A1%E5%BC%8F\"><span class=\"toc-text\">设置 FTP 主动模式</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99\"><span class=\"toc-text\">参考资料：</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%83%A8%E5%88%86%E8%B5%84%E6%BA%90%E4%B8%8E%E6%8B%93%E5%B1%95%E9%98%85%E8%AF%BB\"><span class=\"toc-text\">部分资源与拓展阅读</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%BF%9B%E4%B8%80%E6%AD%A5%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">进一步配置：</span></a></li></ol></li></ol></li></ol>","author":{"name":"JBR_Bunjie","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/90251718?v=4","link":"/","description":"仿生程序员会在光环上遇见AI乐正绫吗？","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili-fill.svg","link":"https://space.bilibili.com/415377461"},"github":{"icon":"/svg/social_github.svg","link":"https://github.com/JBR-Bunjie"}}}},"mapped":true,"prev_post":{"title":"从Json杀到Yaml","uid":"2679faecf929a89d04089c85f6582773","slug":"Language Learning/MARK LANGUAGE/从json杀到yaml","date":"2021-11-16T08:15:04.000Z","updated":"2021-11-16T08:15:34.000Z","comments":true,"path":"api/articles/Language Learning/MARK LANGUAGE/从json杀到yaml.json","keywords":null,"cover":"https://raw.githubusercontent.com/JBR-Bunjie/JBR-Bunjie/main/back.jpg","text":"从Json杀到Yaml Json介绍 什么是Json？ JSON (JavaScript Object Notation) is a lightweight data-interchange format. It is easy for humans to read and wr...","link":"","photos":[],"count_time":{"symbolsCount":"6.5k","symbolsTime":"6 mins."},"categories":[{"name":"Programming Language Learning","slug":"Programming-Language-Learning","count":3,"path":"api/categories/Programming-Language-Learning.json"}],"tags":[{"name":"Json","slug":"Json","count":2,"path":"api/tags/Json.json"}],"author":{"name":"JBR_Bunjie","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/90251718?v=4","link":"/","description":"仿生程序员会在光环上遇见AI乐正绫吗？","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili-fill.svg","link":"https://space.bilibili.com/415377461"},"github":{"icon":"/svg/social_github.svg","link":"https://github.com/JBR-Bunjie"}}}}},"next_post":{"title":"私有Git仓库搭建","uid":"f859a0dc217f052fa5c43eafb964028a","slug":"Deploy/SetupPrivateGitRepository/Setup Private Git Repository ","date":"2021-10-05T03:05:03.000Z","updated":"2023-03-15T15:41:07.791Z","comments":true,"path":"api/articles/Deploy/SetupPrivateGitRepository/Setup Private Git Repository .json","keywords":null,"cover":"https://raw.githubusercontent.com/JBR-Bunjie/JBR-Bunjie/main/back.jpg","text":"云服务器上的私有Git仓库搭建 环境： 阿里云服务器CentOS7.6 部署Git 安装Git： 非CentOS安装Git： 绝大多数Linux发行版安装Git只需要一条命令——参看：Git官方指南 关于CentOS安装： 与绝大部分Linux系统不同，redhat发行的系统通过...","link":"","photos":[],"count_time":{"symbolsCount":"4.2k","symbolsTime":"4 mins."},"categories":[{"name":"配置方法","slug":"配置方法","count":4,"path":"api/categories/配置方法.json"}],"tags":[{"name":"Git","slug":"Git","count":2,"path":"api/tags/Git.json"}],"author":{"name":"JBR_Bunjie","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/90251718?v=4","link":"/","description":"仿生程序员会在光环上遇见AI乐正绫吗？","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"bilibili":{"icon":"/svg/bilibili-fill.svg","link":"https://space.bilibili.com/415377461"},"github":{"icon":"/svg/social_github.svg","link":"https://github.com/JBR-Bunjie"}}}}}}